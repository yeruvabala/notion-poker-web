#!/bin/bash

echo "ğŸ” Pre-push checks running..."
echo ""

# Change to repo root
cd "$(git rev-parse --show-toplevel)"

# 1. TypeScript type check (fast!)
echo "ğŸ“ Checking TypeScript types..."
npx tsc --noEmit

if [ $? -ne 0 ]; then
    echo ""
    echo "âŒ TypeScript type errors found!"
    echo "ğŸ’¡ Fix the errors above and try pushing again."
    echo ""
    exit 1
fi

echo "âœ… TypeScript types OK"
echo ""

# 2. Lint check (fast!)
echo "ğŸ¨ Running linter..."
npm run lint --silent

if [ $? -ne 0 ]; then
    echo ""
    echo "âŒ Linting errors found!"
    echo "ğŸ’¡ Fix the errors above and try pushing again."
    echo ""
    exit 1
fi

echo "âœ… Linting OK"
echo ""

# Optional: Skip build check for speed (build takes ~30s)
# Uncomment the lines below if you want full build check
# echo "ğŸ—ï¸  Running build..."
# npm run build
# if [ $? -ne 0 ]; then
#     echo ""
#     echo "âŒ Build failed!"
#     echo ""
#     exit 1
# fi
# echo "âœ… Build OK"

echo "âœ… All checks passed! Pushing..."
echo ""
exit 0
