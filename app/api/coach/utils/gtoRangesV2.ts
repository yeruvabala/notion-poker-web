/**
 * GTO Preflop Ranges V2 for 6-Max Cash Games
 * 
 * Source: GTO Wizard - 100bb 6-max Cash, Simple 3x, 3b GTO
 * 
 * This file provides range-based preflop decision making extracted
 * directly from GTO Wizard solver outputs.
 * 
 * ============================================================================
 * CRITICAL: UNDERSTANDING RANGE HIERARCHY (READ BEFORE INTEGRATION!)
 * ============================================================================
 * 
 * All frequencies in this file are RELATIVE TO THE PREVIOUS ACTION'S RANGE,
 * NOT absolute frequencies of all 1326 starting hand combinations.
 * 
 * EXAMPLE - BB facing UTG 4-bet:
 * 
 *   Step 1: UTG opens (RFI_RANGES_V2['UTG']) 
 *           → ~15% of all hands ≈ 199 combos
 * 
 *   Step 2: BB 3-bets (THREE_BET_RANGES_V2['BB_vs_UTG']['3bet'])
 *           → 5.4% of all hands ≈ 71 combos
 *           → These 71 combos are BB's 3-bet range
 * 
 *   Step 3: UTG 4-bets, BB now faces a decision
 *           (VS_FOUR_BET_RANGES_V2['BB_vs_UTG_4bet'])
 *           → All-in: 31.2% = 31.2% OF THE 71 COMBOS (≈22 combos), NOT 31.2% of 1326!
 *           → Call:   23.5% = 23.5% OF THE 71 COMBOS (≈17 combos)
 *           → Fold:   45.3% = 45.3% OF THE 71 COMBOS (≈32 combos)
 * 
 * HIERARCHY:
 *   1326 combos → RFI/Facing Open → 3-Bet Range → Facing 4-Bet → Facing 5-Bet
 *                        ↓                 ↓              ↓
 *                   % of 1326       % of 3-bet range  % of 4-bet range
 * 
 * FOR AI AGENTS - INTEGRATION NOTES:
 * 
 *   1. When evaluating a hand at a decision point, first verify the hand
 *      is in the previous action's range before checking current action.
 * 
 *   2. For hand like QQ in BB vs UTG 4-bet:
 *      - Check: THREE_BET_RANGES_V2['BB_vs_UTG']['3bet']['QQ'] → 0.5 (50% 3-bet)
 *      - Then:  VS_FOUR_BET_RANGES_V2['BB_vs_UTG_4bet']['allin']['QQ'] → 0.6
 *      - Meaning: Of the QQ combos that 3-bet, 60% go all-in vs 4-bet
 * 
 *   3. SPOT_AGGREGATE_STATS percentages also follow this pattern:
 *      - 'BB_vs_UTG_4bet': { raise: 0.312, call: 0.235, fold: 0.453 }
 *      - These sum to 1.0 because they represent 100% of the 3-bet range
 * 
 *   4. For quick lookups, use the getSpotStats() helper function.
 * 
 *   5. TODO for integration: Consider adding helper functions like:
 *      - getAbsoluteFrequency(hand, actionChain) → calculates compound probability
 *      - isHandInRange(hand, scenario) → validates hand is in previous range
 * 
 * ============================================================================
 */

// =============================================================================
// TYPES (Re-exported for compatibility)
// =============================================================================

export interface RangeAction {
    action: 'raise' | 'call' | 'fold' | '3bet' | '4bet' | '5bet';
    frequency: number;  // 0.0 to 1.0
    sizing?: string;    // e.g., "2.5bb", "3bb"
}

export type Position = 'UTG' | 'HJ' | 'CO' | 'BTN' | 'SB' | 'BB';

export interface RangeResult {
    found: boolean;
    action: RangeAction;
    scenario: string;
    source: 'range_table' | 'llm_fallback';
}

// =============================================================================
// HAND NORMALIZATION (copied from gtoRanges.ts for standalone use)
// =============================================================================

export function normalizeHand(hand: string): string {
    const cleaned = hand.replace(/\s+/g, '').toUpperCase();
    if (cleaned.length === 3 && (cleaned.endsWith('S') || cleaned.endsWith('O'))) {
        return cleaned.slice(0, 2) + cleaned.slice(2).toLowerCase();
    }
    if (cleaned.length === 2 && cleaned[0] === cleaned[1]) {
        return cleaned;
    }
    const cardPattern = /([2-9TJQKA])([♠♥♦♣SHDC])/gi;
    const matches = [...cleaned.matchAll(cardPattern)];
    if (matches.length < 2) {
        if (cleaned.length === 2) return cleaned;
        return cleaned.slice(0, 2).toUpperCase();
    }
    const rank1 = matches[0][1].toUpperCase();
    const suit1 = matches[0][2].toUpperCase();
    const rank2 = matches[1][1].toUpperCase();
    const suit2 = matches[1][2].toUpperCase();
    const normSuit = (s: string) => ({ '♠': 's', 'S': 's', '♥': 'h', 'H': 'h', '♦': 'd', 'D': 'd', '♣': 'c', 'C': 'c' }[s] || s.toLowerCase());
    const rankOrder = '23456789TJQKA';
    const val1 = rankOrder.indexOf(rank1);
    const val2 = rankOrder.indexOf(rank2);
    if (rank1 === rank2) return `${rank1}${rank2}`;
    const [high, low] = val1 > val2 ? [rank1, rank2] : [rank2, rank1];
    const suited = normSuit(suit1) === normSuit(suit2);
    return `${high}${low}${suited ? 's' : 'o'}`;
}

export function normalizePosition(position: string): string {
    const posUpper = position.toUpperCase().replace(/\s+/g, '');
    const positionMap: Record<string, string> = {
        'BTN': 'BTN', 'BU': 'BTN', 'BUTTON': 'BTN', 'D': 'BTN', 'DEALER': 'BTN',
        'CO': 'CO', 'CUTOFF': 'CO',
        'HJ': 'HJ', 'HIJACK': 'HJ', 'MP': 'HJ', 'MP1': 'HJ', 'MP2': 'HJ', 'LJ': 'HJ', 'LOJACK': 'HJ',
        'UTG': 'UTG', 'EP': 'UTG', 'EARLYPOSITION': 'UTG', 'UTG+1': 'UTG', 'UTG1': 'UTG', 'UTG+2': 'UTG', 'UTG2': 'UTG',
        'SB': 'SB', 'SMALLBLIND': 'SB',
        'BB': 'BB', 'BIGBLIND': 'BB',
    };
    return positionMap[posUpper] || posUpper;
}

// =============================================================================
// RFI (RAISE FIRST IN) RANGES - 6-MAX 100BB
// Source: GTO Wizard Screenshots
// =============================================================================

export const RFI_RANGES_V2: Record<string, Record<string, number>> = {

    // =========================================================================
    // UTG RFI - 16.4% of hands, Raise 3x
    // =========================================================================
    UTG: {
        // Pairs
        'AA': 1.0, 'KK': 1.0, 'QQ': 1.0, 'JJ': 1.0, 'TT': 1.0,
        '99': 1.0, '88': 1.0, '77': 1.0, '66': 1.0, '55': 0.61, '44': 0.11,
        // Suited Aces
        'AKs': 1.0, 'AQs': 1.0, 'AJs': 1.0, 'ATs': 1.0, 'A9s': 1.0,
        'A8s': 1.0, 'A7s': 1.0, 'A6s': 1.0, 'A5s': 1.0, 'A4s': 1.0,
        'A3s': 1.0, 'A2s': 0.42,
        // Suited Kings
        'KQs': 1.0, 'KJs': 1.0, 'KTs': 1.0, 'K9s': 1.0, 'K8s': 1.0,
        'K7s': 0.34, 'K5s': 0.23,
        // Suited Queens
        'QJs': 1.0, 'QTs': 1.0, 'Q9s': 0.64,
        // Suited Jacks
        'JTs': 1.0, 'J9s': 0.58,
        // Suited Connectors
        'T9s': 1.0, '87s': 0.20, '76s': 0.36, '65s': 0.46, '54s': 0.40,
        // Offsuit Aces
        'AKo': 1.0, 'AQo': 1.0, 'AJo': 1.0, 'ATo': 0.69,
        // Offsuit Kings
        'KQo': 1.0, 'KJo': 0.74,
        // Offsuit Queens
        'QJo': 0.18,
    },

    // =========================================================================
    // HJ RFI - 20.3% of hands, Raise 3x
    // =========================================================================
    HJ: {
        // Pairs
        'AA': 1.0, 'KK': 1.0, 'QQ': 1.0, 'JJ': 1.0, 'TT': 1.0,
        '99': 1.0, '88': 1.0, '77': 1.0, '66': 1.0, '55': 1.0,
        '44': 0.42, '33': 0.10,
        // Suited Aces - All
        'AKs': 1.0, 'AQs': 1.0, 'AJs': 1.0, 'ATs': 1.0, 'A9s': 1.0,
        'A8s': 1.0, 'A7s': 1.0, 'A6s': 1.0, 'A5s': 1.0, 'A4s': 1.0,
        'A3s': 1.0, 'A2s': 1.0,
        // Suited Kings
        'KQs': 1.0, 'KJs': 1.0, 'KTs': 1.0, 'K9s': 1.0, 'K8s': 1.0,
        'K7s': 1.0, 'K6s': 0.80, 'K5s': 0.68,
        // Suited Queens
        'QJs': 1.0, 'QTs': 1.0, 'Q9s': 1.0, 'Q8s': 0.28,
        // Suited Jacks
        'JTs': 1.0, 'J9s': 1.0,
        // Suited Connectors
        'T9s': 1.0, 'T8s': 1.0, '98s': 0.89, '87s': 0.27,
        '76s': 0.39, '65s': 0.58, '54s': 0.53,
        // Offsuit Aces
        'AKo': 1.0, 'AQo': 1.0, 'AJo': 1.0, 'ATo': 1.0,
        // Offsuit Kings
        'KQo': 1.0, 'KJo': 1.0, 'KTo': 0.42,
        // Offsuit Queens
        'QJo': 0.79, 'QTo': 0.21,
        // Offsuit Jacks
        'JTo': 0.15,
    },

    // =========================================================================
    // CO RFI - 26.9% of hands, Raise 3x
    // =========================================================================
    CO: {
        // All Pairs
        'AA': 1.0, 'KK': 1.0, 'QQ': 1.0, 'JJ': 1.0, 'TT': 1.0,
        '99': 1.0, '88': 1.0, '77': 1.0, '66': 1.0, '55': 1.0,
        '44': 1.0, '33': 0.79, '22': 0.19,
        // Suited Aces - All
        'AKs': 1.0, 'AQs': 1.0, 'AJs': 1.0, 'ATs': 1.0, 'A9s': 1.0,
        'A8s': 1.0, 'A7s': 1.0, 'A6s': 1.0, 'A5s': 1.0, 'A4s': 1.0,
        'A3s': 1.0, 'A2s': 1.0,
        // Suited Kings - All
        'KQs': 1.0, 'KJs': 1.0, 'KTs': 1.0, 'K9s': 1.0, 'K8s': 1.0,
        'K7s': 1.0, 'K6s': 1.0, 'K5s': 1.0, 'K4s': 1.0, 'K3s': 0.42,
        // Suited Queens
        'QJs': 1.0, 'QTs': 1.0, 'Q9s': 1.0, 'Q8s': 1.0, 'Q7s': 0.68,
        'Q6s': 0.54, 'Q5s': 0.11,
        // Suited Jacks
        'JTs': 1.0, 'J9s': 1.0, 'J8s': 1.0,
        // Suited Tens
        'T9s': 1.0, 'T8s': 1.0, 'T7s': 0.57,
        // Suited Connectors
        '98s': 1.0, '97s': 1.0, '87s': 1.0, '86s': 0.29,
        '76s': 0.79, '65s': 0.92, '54s': 0.66,
        // Offsuit Aces
        'AKo': 1.0, 'AQo': 1.0, 'AJo': 1.0, 'ATo': 1.0, 'A9o': 1.0,
        'A8o': 0.25,
        // Offsuit Kings
        'KQo': 1.0, 'KJo': 1.0, 'KTo': 1.0,
        // Offsuit Queens
        'QJo': 1.0, 'QTo': 1.0,
        // Offsuit Jacks
        'JTo': 1.0,
    },

    // =========================================================================
    // BTN RFI - 40.8% of hands, Raise 3x
    // =========================================================================
    BTN: {
        // All Pairs
        'AA': 1.0, 'KK': 1.0, 'QQ': 1.0, 'JJ': 1.0, 'TT': 1.0,
        '99': 1.0, '88': 1.0, '77': 1.0, '66': 1.0, '55': 1.0,
        '44': 1.0, '33': 1.0, '22': 1.0,
        // All Suited Aces
        'AKs': 1.0, 'AQs': 1.0, 'AJs': 1.0, 'ATs': 1.0, 'A9s': 1.0,
        'A8s': 1.0, 'A7s': 1.0, 'A6s': 1.0, 'A5s': 1.0, 'A4s': 1.0,
        'A3s': 1.0, 'A2s': 1.0,
        // All Suited Kings
        'KQs': 1.0, 'KJs': 1.0, 'KTs': 1.0, 'K9s': 1.0, 'K8s': 1.0,
        'K7s': 1.0, 'K6s': 1.0, 'K5s': 1.0, 'K4s': 1.0, 'K3s': 1.0, 'K2s': 1.0,
        // Suited Queens
        'QJs': 1.0, 'QTs': 1.0, 'Q9s': 1.0, 'Q8s': 1.0, 'Q7s': 1.0,
        'Q6s': 1.0, 'Q5s': 1.0, 'Q4s': 1.0, 'Q3s': 1.0, 'Q2s': 0.48,
        // Suited Jacks
        'JTs': 1.0, 'J9s': 1.0, 'J8s': 1.0, 'J7s': 1.0, 'J6s': 1.0, 'J5s': 1.0, 'J4s': 0.37,
        // Suited Tens
        'T9s': 1.0, 'T8s': 1.0, 'T7s': 1.0, 'T6s': 1.0,
        // Suited Connectors
        '98s': 1.0, '97s': 1.0, '96s': 1.0,
        '87s': 1.0, '86s': 1.0, '85s': 0.31,
        '76s': 1.0, '75s': 1.0,
        '65s': 1.0, '64s': 0.10,
        '54s': 1.0,
        // Offsuit Aces
        'AKo': 1.0, 'AQo': 1.0, 'AJo': 1.0, 'ATo': 1.0, 'A9o': 1.0,
        'A8o': 1.0, 'A7o': 1.0, 'A6o': 1.0, 'A5o': 1.0, 'A4o': 1.0,
        // Offsuit Kings
        'KQo': 1.0, 'KJo': 1.0, 'KTo': 1.0, 'K9o': 1.0, 'K8o': 0.47,
        // Offsuit Queens
        'QJo': 1.0, 'QTo': 1.0, 'Q9o': 1.0,
        // Offsuit Jacks
        'JTo': 1.0, 'J9o': 1.0, 'J8o': 0.14,
        // Offsuit Tens
        'T9o': 1.0, 'T8o': 0.33,
        // Offsuit Connectors
        '98o': 0.32,
    },

    // =========================================================================
    // SB RFI (vs BB only) - 43.1% of hands, Raise 3.5x
    // =========================================================================
    SB: {
        // All Pairs
        'AA': 1.0, 'KK': 1.0, 'QQ': 1.0, 'JJ': 1.0, 'TT': 1.0,
        '99': 1.0, '88': 1.0, '77': 1.0, '66': 1.0, '55': 1.0,
        '44': 1.0, '33': 1.0, '22': 1.0,
        // All Suited Aces
        'AKs': 1.0, 'AQs': 1.0, 'AJs': 1.0, 'ATs': 1.0, 'A9s': 1.0,
        'A8s': 1.0, 'A7s': 1.0, 'A6s': 1.0, 'A5s': 1.0, 'A4s': 1.0,
        'A3s': 1.0, 'A2s': 1.0,
        // All Suited Kings
        'KQs': 1.0, 'KJs': 1.0, 'KTs': 1.0, 'K9s': 1.0, 'K8s': 1.0,
        'K7s': 1.0, 'K6s': 1.0, 'K5s': 1.0, 'K4s': 1.0, 'K3s': 1.0, 'K2s': 1.0,
        // All Suited Queens
        'QJs': 1.0, 'QTs': 1.0, 'Q9s': 1.0, 'Q8s': 1.0, 'Q7s': 1.0,
        'Q6s': 1.0, 'Q5s': 1.0, 'Q4s': 1.0, 'Q3s': 1.0, 'Q2s': 1.0,
        // Suited Jacks
        'JTs': 1.0, 'J9s': 1.0, 'J8s': 1.0, 'J7s': 1.0, 'J6s': 1.0, 'J5s': 1.0, 'J4s': 1.0, 'J3s': 0.41,
        // Suited Tens
        'T9s': 1.0, 'T8s': 1.0, 'T7s': 1.0, 'T6s': 1.0, 'T5s': 0.30,
        // Suited Nines+
        '98s': 1.0, '97s': 1.0, '96s': 1.0, '95s': 0.39,
        '87s': 1.0, '86s': 1.0, '85s': 1.0,
        '76s': 1.0, '75s': 1.0, '74s': 1.0,
        '65s': 1.0, '64s': 1.0,
        '54s': 1.0, '53s': 1.0,
        // Offsuit Aces
        'AKo': 1.0, 'AQo': 1.0, 'AJo': 1.0, 'ATo': 1.0, 'A9o': 1.0,
        'A8o': 1.0, 'A7o': 1.0, 'A6o': 1.0, 'A5o': 1.0, 'A4o': 0.85,
        // Offsuit Kings
        'KQo': 1.0, 'KJo': 1.0, 'KTo': 1.0, 'K9o': 1.0, 'K8o': 0.57,
        // Offsuit Queens
        'QJo': 1.0, 'QTo': 1.0, 'Q9o': 1.0,
        // Offsuit Jacks
        'JTo': 1.0, 'J9o': 1.0,
        // Offsuit Tens
        'T9o': 1.0, 'T8o': 0.54,
        // Offsuit Connectors
        '98o': 0.82, '87o': 0.27,
    },

    // MP alias for HJ (6-max)
    MP: {},
};

// Copy HJ to MP for 6-max compatibility
RFI_RANGES_V2.MP = { ...RFI_RANGES_V2.HJ };

// =============================================================================
// 3-BET RANGES (When facing an open raise)
// To be populated from additional screenshots
// =============================================================================

export const THREE_BET_RANGES_V2: Record<string, Record<string, Record<string, number>>> = {

    // =========================================================================
    // BB vs SB (SB opens 3.5x) - Widest defense
    // Raise 10.5: 16.3%, Call: 42.1%, Fold: 41.6%
    // =========================================================================
    'BB_vs_SB': {
        '3bet': {
            // Premium value 3-bets
            'AA': 1.0, 'KK': 1.0, 'QQ': 1.0, 'JJ': 1.0, 'TT': 1.0,
            '99': 0.59, '88': 0.34, '77': 0.20, '66': 0.27,
            'AKs': 1.0, 'AQs': 1.0, 'AJs': 1.0, 'ATs': 0.18,
            'A7s': 0.11, 'A5s': 1.0, 'A4s': 0.81, 'A3s': 0.47,
            'KQs': 1.0, 'KJs': 1.0, 'KTs': 0.67, 'K9s': 0.25, 'K8s': 0.14,
            'AKo': 1.0, 'AQo': 1.0, 'AJo': 0.33, 'KQo': 0.32,
            // Value/Bluff mixes
            'QJs': 0.64, 'QTs': 1.0, 'Q9s': 0.48,
            'JTs': 1.0, 'J9s': 0.80, 'J4s': 0.11,
            'T9s': 1.0, 'T8s': 0.85, 'T5s': 0.43, 'T4s': 0.70, 'T2s': 0.14,
            '98s': 1.0, '97s': 0.63, '93s': 0.10,
            '87s': 1.0, '76s': 1.0, '65s': 1.0, '54s': 1.0, '53s': 0.09,
            'K9o': 0.20, 'Q9o': 0.17, 'J9o': 0.21, 'T9o': 0.13,
            'K8o': 0.44, 'Q8o': 0.44, 'J8o': 0.61, 'T8o': 0.20,
            'A7o': 0.31, 'K7o': 0.38, 'T7o': 0.35,
            'A6o': 0.51, 'K6o': 0.33,
            'A5o': 0.09, 'K5o': 0.18,
            'A4o': 0.15, 'A3o': 0.28, 'A2o': 0.52,
        },
        'call': {
            // Pairs
            '99': 0.41, '88': 0.66, '77': 0.80, '66': 0.70,
            '55': 1.0, '44': 1.0, '33': 1.0, '22': 1.0,
            // Suited Aces
            'ATs': 0.82, 'A9s': 1.0, 'A8s': 1.0, 'A7s': 0.89, 'A6s': 1.0,
            'A4s': 0.19, 'A3s': 0.53, 'A2s': 1.0,
            // Suited Kings
            'KTs': 0.33, 'K9s': 0.75, 'K8s': 0.86, 'K7s': 1.0,
            'K6s': 1.0, 'K5s': 1.0, 'K4s': 1.0, 'K3s': 1.0, 'K2s': 1.0,
            // Suited Queens
            'QJs': 0.36, 'Q9s': 0.52, 'Q8s': 1.0, 'Q7s': 1.0,
            'Q6s': 1.0, 'Q5s': 1.0, 'Q4s': 1.0, 'Q3s': 1.0, 'Q2s': 1.0,
            // Suited Jacks
            'JTs': 0.0, 'J9s': 0.20, 'J8s': 1.0, 'J7s': 1.0, 'J6s': 1.0,
            'J5s': 1.0, 'J4s': 0.89, 'J3s': 1.0, 'J2s': 1.0,
            // Suited Tens+
            'T9s': 0.0, 'T8s': 0.15, 'T7s': 1.0, 'T6s': 1.0, 'T5s': 0.57, 'T4s': 0.30, 'T3s': 1.0, 'T2s': 0.86,
            '97s': 0.37, '96s': 1.0, '95s': 1.0, '94s': 1.0, '93s': 0.90,
            '86s': 1.0, '85s': 1.0, '84s': 1.0,
            '75s': 1.0, '74s': 1.0, '73s': 1.0,
            '64s': 1.0, '63s': 1.0, '62s': 1.0,
            '53s': 0.91, '52s': 1.0,
            '43s': 1.0, '42s': 1.0,
            '32s': 1.0,
            // Offsuit
            'AJo': 0.67, 'ATo': 1.0, 'A9o': 1.0, 'A8o': 1.0, 'A7o': 0.69,
            'A6o': 0.49, 'A5o': 0.91, 'A4o': 0.85, 'A3o': 0.72, 'A2o': 0.48,
            'KQo': 0.68, 'KJo': 0.90, 'KTo': 1.0, 'K9o': 0.80, 'K8o': 0.56,
            'K7o': 0.62, 'K6o': 0.39,
            'QJo': 1.0, 'QTo': 1.0, 'Q9o': 0.83, 'Q8o': 0.56,
            'JTo': 1.0, 'J9o': 0.79, 'J8o': 0.39,
            'T9o': 0.87, 'T8o': 0.80,
            '98o': 1.0, '97o': 0.46,
            '87o': 1.0, '76o': 1.0, '65o': 1.0, '54o': 0.89,
        },
    },

    // =========================================================================
    // BB vs BTN (BTN opens 3x) - Second widest
    // Raise 13.5: 13.2%, Call: 27.6%, Fold: 59.2%
    // =========================================================================
    'BB_vs_BTN': {
        '3bet': {
            'AA': 1.0, 'KK': 1.0, 'QQ': 1.0, 'JJ': 1.0, 'TT': 1.0,
            '99': 0.84, '88': 0.41, '77': 0.25, '66': 0.22,
            'AKs': 1.0, 'AQs': 1.0, 'AJs': 1.0, 'A8s': 0.10, 'A7s': 0.30,
            'A5s': 1.0, 'A4s': 0.54, 'A3s': 0.26,
            'KQs': 1.0, 'KJs': 0.72, 'KTs': 0.37, 'K9s': 0.52, 'K8s': 0.11, 'K6s': 0.23, 'K5s': 0.09,
            'QJs': 1.0, 'QTs': 1.0, 'Q9s': 0.45, 'Q8s': 0.10, 'Q6s': 0.16,
            'JTs': 1.0, 'J9s': 1.0, 'J8s': 0.56, 'J7s': 0.47, 'J6s': 0.11, 'J5s': 0.21,
            'T9s': 1.0, 'T8s': 0.79, 'T7s': 0.44, 'T6s': 0.20,
            '98s': 0.69, '96s': 0.34,
            '87s': 0.76, '76s': 0.60, '65s': 0.72, '54s': 0.72,
            'AKo': 1.0, 'AQo': 1.0, 'AJo': 0.32, 'ATo': 0.21, 'A9o': 0.11, 'A8o': 0.19, 'A7o': 0.15, 'A5o': 0.14,
            'KQo': 0.47, 'KJo': 0.28, 'KTo': 0.38, 'K9o': 0.10,
            'JTo': 0.25, 'T9o': 0.17,
        },
        'call': {
            '99': 0.15, '88': 0.59, '77': 0.73, '66': 0.75,
            '55': 1.0, '44': 1.0, '33': 1.0, '22': 1.0,
            'ATs': 1.0, 'A9s': 1.0, 'A8s': 0.90, 'A7s': 0.70, 'A6s': 1.0,
            'A4s': 0.47, 'A3s': 0.74, 'A2s': 1.0,
            'KJs': 0.28, 'KTs': 0.63, 'K9s': 0.48, 'K8s': 0.89, 'K7s': 1.0,
            'K6s': 0.78, 'K5s': 0.91, 'K4s': 1.0, 'K3s': 1.0, 'K2s': 1.0,
            'Q9s': 0.55, 'Q8s': 0.90, 'Q7s': 1.0, 'Q6s': 0.84, 'Q5s': 1.0, 'Q4s': 1.0, 'Q3s': 1.0, 'Q2s': 1.0,
            'J9s': 0.0, 'J8s': 0.44, 'J7s': 0.54, 'J6s': 0.89, 'J5s': 0.79, 'J4s': 1.0, 'J3s': 1.0,
            'T8s': 0.21, 'T7s': 0.56, 'T6s': 0.80,
            '98s': 0.31, '97s': 1.0, '96s': 0.66,
            '87s': 0.24, '86s': 1.0, '85s': 1.0,
            '76s': 0.40, '75s': 1.0, '74s': 1.0,
            '65s': 0.28, '64s': 1.0, '63s': 1.0,
            '54s': 0.28, '53s': 1.0, '52s': 1.0,
            '43s': 1.0, '42s': 0.48,
            'AJo': 0.68, 'ATo': 0.79, 'A9o': 0.89, 'A8o': 0.81, 'A7o': 0.85, 'A5o': 0.86,
            'KQo': 0.53, 'KJo': 0.72, 'KTo': 0.62, 'K9o': 0.90,
            'QJo': 1.0, 'QTo': 1.0, 'Q9o': 0.46,
            'JTo': 0.75, 'J9o': 0.71,
            'T9o': 0.83, 'T8o': 0.20,
            '98o': 0.36, '87o': 0.36,
        },
    },

    // =========================================================================
    // BB vs CO (CO opens 3x)
    // Raise 14: 8.9%, Call: 20.8%, Fold: 70.3%
    // =========================================================================
    'BB_vs_CO': {
        '3bet': {
            'AA': 1.0, 'KK': 1.0, 'QQ': 1.0, 'JJ': 1.0, 'TT': 0.57,
            '99': 0.17, '77': 0.10, '66': 0.11,
            'AKs': 1.0, 'AQs': 1.0, 'AJs': 0.29, 'A9s': 0.26, 'A8s': 0.11,
            'A7s': 1.0, 'A6s': 0.25, 'A5s': 0.62, 'A2s': 0.42,
            'KQs': 0.70, 'KJs': 0.89, 'KTs': 0.47, 'K9s': 0.21, 'K7s': 0.17, 'K6s': 0.31, 'K5s': 0.31, 'K4s': 0.09, 'K2s': 0.11,
            'QJs': 1.0, 'QTs': 0.66, 'Q9s': 0.44, 'Q8s': 0.28,
            'JTs': 1.0, 'J9s': 0.51, 'J8s': 0.34,
            'T9s': 0.41, 'T8s': 0.36, 'T7s': 0.20,
            '98s': 0.16, '97s': 0.20, '96s': 0.09,
            '87s': 0.32, '76s': 0.49, '65s': 0.56, '54s': 0.40,
            'AKo': 1.0, 'AQo': 0.40, 'AJo': 0.13, 'ATo': 0.32,
            'KQo': 0.25, 'KJo': 0.25, 'QJo': 0.24, 'KTo': 0.09,
        },
        'call': {
            'TT': 0.43, '99': 0.83, '88': 1.0, '77': 0.89, '66': 0.86,
            '55': 1.0, '44': 1.0, '33': 1.0, '22': 1.0,
            'AJs': 0.71, 'ATs': 1.0, 'A9s': 0.74, 'A8s': 0.89, 'A6s': 0.75,
            'A5s': 0.38, 'A4s': 1.0, 'A3s': 1.0, 'A2s': 0.58,
            'KQs': 0.30, 'KJs': 0.11, 'KTs': 0.54, 'K9s': 0.79, 'K8s': 1.0,
            'K7s': 0.83, 'K6s': 0.69, 'K5s': 0.69, 'K4s': 0.91, 'K3s': 1.0, 'K2s': 0.89,
            'QTs': 0.34, 'Q9s': 0.56, 'Q8s': 0.72, 'Q7s': 1.0, 'Q6s': 0.89, 'Q5s': 0.83,
            'J9s': 0.49, 'J8s': 0.66, 'J7s': 0.61,
            'T9s': 0.59, 'T8s': 0.64, 'T7s': 0.80,
            '98s': 0.84, '97s': 0.80, '96s': 0.91,
            '87s': 0.68, '86s': 1.0, '85s': 1.0,
            '76s': 0.51, '75s': 1.0, '74s': 0.37,
            '65s': 0.44, '64s': 1.0,
            '54s': 0.60, '53s': 1.0,
            '43s': 1.0,
            'AQo': 0.60, 'AJo': 0.88, 'ATo': 0.68, 'A9o': 0.64,
            'KQo': 0.75, 'KJo': 0.75, 'KTo': 0.73, 'QJo': 0.76, 'QTo': 0.66, 'JTo': 0.84,
        },
    },

    // =========================================================================
    // BB vs HJ (HJ opens 3x)
    // Raise 14: 6.9%, Call: 18.2%, Fold: 74.9%
    // =========================================================================
    'BB_vs_HJ': {
        '3bet': {
            'AA': 1.0, 'KK': 1.0, 'QQ': 1.0, 'JJ': 0.4,
            'AKs': 1.0, 'AQs': 0.5,
            'A5s': 0.5, 'A4s': 0.3,
            'AKo': 1.0, 'AQo': 0.3,
        },
        'call': {
            'JJ': 0.6, 'TT': 1.0, '99': 1.0, '88': 1.0, '77': 1.0,
            '66': 0.9, '55': 0.7, '44': 0.5, '33': 0.3, '22': 0.2,
            'AQs': 0.5, 'AJs': 1.0, 'ATs': 1.0, 'A9s': 0.7, 'A8s': 0.5,
            'A5s': 0.5, 'A4s': 0.7, 'A3s': 0.6, 'A2s': 0.5,
            'KQs': 1.0, 'KJs': 1.0, 'KTs': 0.9, 'K9s': 0.5,
            'QJs': 1.0, 'QTs': 0.9, 'Q9s': 0.4,
            'JTs': 1.0, 'J9s': 0.6, 'T9s': 0.9, 'T8s': 0.5,
            '98s': 0.8, '87s': 0.7, '76s': 0.6, '65s': 0.5, '54s': 0.4,
            'AQo': 0.7, 'AJo': 1.0, 'ATo': 0.6,
            'KQo': 1.0, 'KJo': 0.7, 'QJo': 0.5,
        },
    },

    // =========================================================================
    // BB vs UTG (UTG opens 3x) - Tightest defense
    // Raise 14: 5.4%, Call: 16.8%, Fold: 77.8%
    // =========================================================================
    'BB_vs_UTG': {
        '3bet': {
            'AA': 1.0, 'KK': 1.0, 'QQ': 1.0, 'JJ': 0.75, 'TT': 0.13,
            '77': 0.09, '66': 0.09,
            'AKs': 1.0, 'AQs': 0.92, 'ATs': 0.44, 'A8s': 0.20, 'A7s': 0.23, 'A6s': 0.23,
            'A5s': 0.35, 'A4s': 0.57, 'A3s': 0.16, 'A2s': 0.17,
            'KQs': 1.0, 'KJs': 1.0, 'KTs': 0.21, 'K7s': 0.15, 'K6s': 0.27, 'K5s': 0.21, 'K4s': 0.13,
            'QJs': 1.0, 'QTs': 0.43, 'Q9s': 0.24,
            'JTs': 0.55, 'J9s': 0.38, 'J8s': 0.25,
            'T9s': 0.28, 'T8s': 0.28, 'T7s': 0.11,
            '98s': 0.13, '97s': 0.24,
            '87s': 0.31, '86s': 0.11, '76s': 0.39, '65s': 0.42, '54s': 0.58,
            'AKo': 1.0, 'AQo': 0.11, 'AJo': 0.18, 'ATo': 0.11,
            'KQo': 0.14,
        },
        'call': {
            'JJ': 0.25, 'TT': 0.87, '99': 1.0, '88': 1.0, '77': 0.90, '66': 0.89,
            '55': 1.0, '44': 1.0, '33': 1.0, '22': 1.0,
            'AQs': 0.08, 'AJs': 1.0, 'ATs': 0.56, 'A9s': 1.0, 'A8s': 0.80, 'A7s': 0.77, 'A6s': 0.78,
            'A5s': 0.65, 'A4s': 0.43, 'A3s': 0.84, 'A2s': 0.83,
            'KTs': 0.79, 'K9s': 1.0, 'K8s': 1.0, 'K7s': 0.84, 'K6s': 0.73, 'K5s': 0.79, 'K4s': 0.87, 'K3s': 0.11,
            'QTs': 0.57, 'Q9s': 0.76, 'Q8s': 1.0, 'Q5s': 0.14,
            'JTs': 0.45, 'J9s': 0.62, 'J8s': 0.75,
            'T9s': 0.72, 'T8s': 0.72, 'T7s': 0.89,
            '98s': 0.87, '97s': 0.76, '96s': 0.89,
            '87s': 0.69, '86s': 0.89, '85s': 0.29,
            '76s': 0.61, '75s': 1.0,
            '65s': 0.58, '64s': 1.0,
            '54s': 0.42, '53s': 1.0,
            '43s': 1.0,
            'AQo': 0.89, 'AJo': 0.82, 'ATo': 0.89,
            'KQo': 0.86, 'KJo': 1.0,
            'QJo': 0.57, 'QTo': 0.21, 'JTo': 0.35,
        },
    },

    // =========================================================================
    // SB vs UTG (UTG opens 3x) - Tightest SB defense
    // Raise 13: 6.8%, Fold: 93.2% (No calling range - SB should 3-bet or fold)
    // =========================================================================
    'SB_vs_UTG': {
        '3bet': {
            'AA': 1.0, 'KK': 1.0, 'QQ': 1.0, 'JJ': 1.0, 'TT': 1.0,
            '99': 0.38, '88': 0.32, '77': 0.19, '66': 0.09,
            'AKs': 1.0, 'AQs': 1.0, 'AJs': 1.0, 'ATs': 0.75,
            'A5s': 1.0, 'A4s': 0.39,
            'KQs': 1.0, 'KJs': 1.0, 'KTs': 0.78,
            'QJs': 1.0, 'QTs': 0.52,
            'JTs': 0.55,
            '65s': 0.41, '54s': 0.26, '76s': 0.17,
            'AKo': 1.0, 'AQo': 0.30,
        },
        'call': {
            // SB has no calling range vs UTG - must 3-bet or fold
        },
    },

    // =========================================================================
    // SB vs HJ (HJ opens 3x)
    // Raise 13: 8%, Fold: 92%
    // =========================================================================
    'SB_vs_HJ': {
        '3bet': {
            'AA': 1.0, 'KK': 1.0, 'QQ': 1.0, 'JJ': 1.0, 'TT': 1.0, '99': 1.0,
            '88': 0.46, '77': 0.30, '66': 0.10,
            'AKs': 1.0, 'AQs': 1.0, 'AJs': 1.0, 'ATs': 1.0,
            'A5s': 1.0, 'A4s': 0.41,
            'KQs': 1.0, 'KJs': 1.0, 'KTs': 1.0,
            'AQo': 1.0,
            'QJs': 1.0, 'QTs': 0.52,
            'JTs': 0.55,
            '65s': 0.34, '54s': 0.20, '76s': 0.17,
            'AKo': 1.0,
        },
        'call': {
            // SB has minimal/no calling range vs HJ
        },
    },

    // =========================================================================
    // SB vs CO (CO opens 3x)
    // Raise 13: 10.1%, Fold: 89.9%
    // =========================================================================
    'SB_vs_CO': {
        '3bet': {
            'AA': 1.0, 'KK': 1.0, 'QQ': 1.0, 'JJ': 1.0, 'TT': 1.0, '99': 1.0, '88': 1.0,
            '77': 0.61, '66': 0.34,
            'AKs': 1.0, 'AQs': 1.0, 'AJs': 1.0, 'ATs': 1.0, 'A9s': 1.0,
            'A8s': 0.25, 'A5s': 1.0, 'A4s': 0.73,
            'KQs': 1.0, 'KJs': 1.0, 'KTs': 1.0, 'K9s': 0.09,
            'QJs': 1.0, 'QTs': 1.0,
            'JTs': 1.0, 'J9s': 0.24,
            'T9s': 0.24,
            '65s': 0.34, '54s': 0.14,
            'AKo': 1.0, 'AQo': 1.0, 'AJo': 0.21, 'KQo': 0.49,
        },
        'call': {
            // SB has minimal calling range vs CO
        },
    },

    // =========================================================================
    // SB vs BTN (BTN opens 3x) - Widest SB defense
    // Raise 12: 14.3%, Fold: 85.7%
    // =========================================================================
    'SB_vs_BTN': {
        '3bet': {
            'AA': 1.0, 'KK': 1.0, 'QQ': 1.0, 'JJ': 1.0, 'TT': 1.0, '99': 1.0, '88': 1.0, '77': 1.0, '66': 1.0,
            '55': 0.61,
            'AKs': 1.0, 'AQs': 1.0, 'AJs': 1.0, 'ATs': 1.0, 'A9s': 1.0, 'A8s': 1.0, 'A7s': 1.0,
            'A5s': 1.0, 'A4s': 1.0,
            'KQs': 1.0, 'KJs': 1.0, 'KTs': 1.0, 'K9s': 1.0,
            'QJs': 1.0, 'QTs': 1.0, 'Q9s': 0.55,
            'JTs': 1.0, 'J9s': 1.0,
            'T9s': 1.0, 'T8s': 0.91,
            '98s': 0.20, '87s': 0.34, '76s': 0.41, '65s': 0.23, '54s': 0.09,
            'AKo': 1.0, 'AQo': 1.0, 'AJo': 1.0, 'KQo': 1.0, 'KJo': 0.29,
        },
        'call': {
            // SB has minimal calling range vs BTN - mostly 3-bet or fold
        },
    },

    // =========================================================================
    // HJ vs UTG (UTG opens 3x, HJ 3-bets or folds)
    // Raise 9.5: 7.2%, Fold: 92.8% (No calling range)
    // =========================================================================
    'HJ_vs_UTG': {
        '3bet': {
            'AA': 1.0, 'KK': 1.0, 'QQ': 1.0, 'JJ': 1.0, 'TT': 1.0,
            '99': 0.38, '88': 0.33, '77': 0.14,
            'AKs': 1.0, 'AQs': 1.0, 'AJs': 1.0, 'ATs': 0.51,
            'A8s': 0.29, 'A7s': 0.28, 'A5s': 0.68, 'A4s': 0.76,
            'KQs': 1.0, 'KJs': 1.0, 'KTs': 1.0, 'K9s': 0.13,
            'QJs': 0.72,
            'T9s': 0.10, '87s': 0.11, '76s': 0.23, '65s': 0.54, '54s': 0.36,
            'AKo': 1.0, 'AQo': 0.49, 'KQo': 0.24,
        },
        'call': {
            // HJ has minimal/no calling range vs UTG - must 3-bet or fold
        },
    },

    // =========================================================================
    // CO vs UTG (UTG opens 3x, CO 3-bets or folds)
    // Raise 9.5: 7.6%, Fold: 92.4% (No calling range)
    // =========================================================================
    'CO_vs_UTG': {
        '3bet': {
            'AA': 1.0, 'KK': 1.0, 'QQ': 1.0, 'JJ': 1.0, 'TT': 1.0,
            '99': 0.44, '88': 0.30, '77': 0.21,
            'AKs': 1.0, 'AQs': 1.0, 'AJs': 1.0, 'ATs': 0.62,
            'A8s': 0.33, 'A7s': 0.17, 'A5s': 0.84, 'A4s': 0.62,
            'KQs': 1.0, 'KJs': 1.0, 'KTs': 1.0,
            'QJs': 1.0, 'QTs': 0.13,
            'JTs': 0.10,
            '87s': 0.14, '76s': 0.24, '65s': 0.49, '54s': 0.39,
            'AKo': 1.0, 'AQo': 0.58, 'KQo': 0.29,
        },
        'call': {
            // CO has no calling range vs UTG open - must 3-bet or fold
        },
    },

    // =========================================================================
    // CO vs HJ (HJ opens 3x, CO 3-bets or folds)
    // Raise 9.5: 8.8%, Fold: 91.2% (No calling range)
    // =========================================================================
    'CO_vs_HJ': {
        '3bet': {
            'AA': 1.0, 'KK': 1.0, 'QQ': 1.0, 'JJ': 1.0, 'TT': 1.0,
            '99': 0.87, '88': 0.42, '77': 0.25, '66': 0.17,
            'AKs': 1.0, 'AQs': 1.0, 'AJs': 1.0, 'ATs': 1.0,
            'A9s': 0.41, 'A8s': 0.44, 'A7s': 0.41, 'A5s': 0.78, 'A4s': 0.83,
            'KQs': 1.0, 'KJs': 1.0, 'KTs': 1.0,
            'QJs': 1.0, 'QTs': 0.31,
            'JTs': 0.24,
            '76s': 0.35, '65s': 0.46, '54s': 0.41,
            'AKo': 1.0, 'AQo': 1.0, 'KQo': 0.47,
        },
        'call': {
            // CO has no calling range vs HJ open - must 3-bet or fold
        },
    },

    // =========================================================================
    // BTN vs UTG (UTG opens 3x, BTN can 3-bet, call, or fold)
    // Raise 10: 5.5%, Call: 10%, Fold: 84.6%
    // Complete extraction from GTO Wizard screenshot
    // =========================================================================
    'BTN_vs_UTG': {
        '3bet': {
            'AA': 1.0, 'KK': 1.0, 'QQ': 0.57, 'JJ': 0.22, 'TT': 0.23,
            '99': 0.14, '88': 0.14, '77': 0.11, '66': 0.14, '55': 0.15,
            'AKs': 1.0, 'AQs': 0.39, 'AJs': 0.17, 'ATs': 0.28, 'A9s': 0.10,
            'A8s': 0.42, 'A7s': 0.42, 'A6s': 0.24, 'A5s': 0.48, 'A4s': 0.51, 'A3s': 0.72, 'A2s': 0.09,
            'KQs': 0.14, 'KJs': 0.09, 'KTs': 0.37, 'K9s': 0.66, 'K8s': 0.13, 'K7s': 0.19,
            'QJs': 0.43, 'QTs': 0.14, 'Q9s': 0.10,
            'JTs': 0.20, 'J9s': 0.38,
            'T9s': 0.38, 'T8s': 0.46,
            '87s': 0.21, '76s': 0.30, '65s': 0.34, '54s': 0.32,
            'AKo': 0.51, 'AQo': 0.24, 'AJo': 0.13, 'KQo': 0.43, 'KJo': 0.11,
        },
        'call': {
            'QQ': 0.43, 'JJ': 0.78, 'TT': 0.78, '99': 0.86, '88': 0.86,
            '77': 0.87, '66': 0.83, '55': 0.82, '44': 0.73, '33': 0.50, '22': 0.52,
            'AQs': 0.61, 'AJs': 0.83, 'ATs': 0.72, 'A9s': 0.90, 'A8s': 0.58,
            'A7s': 0.58, 'A5s': 0.49, 'A4s': 0.49, 'A3s': 0.28, 'A2s': 0.07,
            'KQs': 0.86, 'KJs': 0.92, 'KTs': 0.63, 'K9s': 0.34,
            'QJs': 0.57, 'QTs': 0.86,
            'JTs': 0.80, 'J9s': 0.62,
            'T9s': 0.62, 'T8s': 0.54,
            '98s': 0.57, '97s': 0.09, '87s': 0.48, '76s': 0.70, '65s': 0.66, '54s': 0.65,
            'AKo': 0.49, 'AQo': 0.76, 'AJo': 0.11, 'KQo': 0.35,
        },
    },

    // =========================================================================
    // BTN vs HJ (HJ opens 3x, BTN can 3-bet, call, or fold)
    // Raise 10: 6.5%, Call: 10.4%, Fold: 83%
    // =========================================================================
    'BTN_vs_HJ': {
        '3bet': {
            'AA': 1.0, 'KK': 1.0, 'QQ': 0.74, 'JJ': 0.32, 'TT': 0.24,
            '99': 0.21, '88': 0.14, '77': 0.10, '66': 0.20, '55': 0.07,
            'AKs': 1.0, 'AQs': 0.29, 'AJs': 0.14, 'ATs': 0.25, 'A9s': 0.13,
            'A8s': 0.21, 'A7s': 0.54, 'A6s': 0.63, 'A5s': 0.41, 'A4s': 0.47, 'A3s': 0.61, 'A2s': 0.48,
            'KQs': 0.13, 'KJs': 0.21, 'KTs': 1.0, 'K9s': 0.50, 'K8s': 0.29, 'K7s': 0.34,
            'QJs': 0.50, 'QTs': 0.19, 'Q9s': 0.56,
            'JTs': 0.27, 'J9s': 0.41,
            'T9s': 0.34, 'T8s': 0.57,
            '98s': 0.13, '87s': 0.26, '76s': 0.31, '65s': 0.31, '54s': 0.37,
            'AKo': 0.67, 'AQo': 0.35, 'AJo': 0.34, 'KQo': 0.56, 'KJo': 0.10,
        },
        'call': {
            'QQ': 0.26, 'JJ': 0.68, 'TT': 0.76, '99': 0.79, '88': 0.85,
            '77': 0.89, '66': 0.78, '55': 0.90, '44': 0.74, '33': 0.63, '22': 0.56,
            'AQs': 0.71, 'AJs': 0.86, 'ATs': 0.75, 'A9s': 0.87, 'A8s': 0.79,
            'A7s': 0.46, 'A6s': 0.17, 'A5s': 0.56, 'A4s': 0.54, 'A3s': 0.39, 'A2s': 0.21,
            'KQs': 0.87, 'KJs': 0.79, 'K9s': 0.50,
            'QJs': 0.50, 'QTs': 0.81, 'Q9s': 0.24,
            'JTs': 0.73, 'J9s': 0.59,
            'T9s': 0.66, 'T8s': 0.41,
            '98s': 0.78, '97s': 0.13, '87s': 0.49, '76s': 0.60, '65s': 0.69, '54s': 0.63,
            'AKo': 0.33, 'AQo': 0.65, 'AJo': 0.45, 'KQo': 0.44,
        },
    },

    // =========================================================================
    // BTN vs CO (CO opens 3x, BTN can 3-bet, call, or fold)
    // Raise 10: 8.4%, Call: 11%, Fold: 80.7%
    // =========================================================================
    'BTN_vs_CO': {
        '3bet': {
            'AA': 1.0, 'KK': 1.0, 'QQ': 0.86, 'JJ': 0.60, 'TT': 0.24,
            '99': 0.23, '88': 0.24, '77': 0.21, '66': 0.30, '55': 0.13,
            'AKs': 1.0, 'AQs': 0.57, 'A9s': 0.34, 'A8s': 0.26, 'A7s': 0.42,
            'A6s': 0.71, 'A5s': 0.42, 'A4s': 0.62, 'A3s': 0.41, 'A2s': 0.80,
            'KQs': 0.11, 'KJs': 0.35, 'KTs': 0.17, 'K9s': 0.34, 'K8s': 0.37, 'K7s': 0.68, 'K5s': 0.25, 'Q8s': 0.09,
            'QJs': 0.52, 'QTs': 0.21, 'Q9s': 0.80,
            'JTs': 0.35, 'J9s': 0.50,
            'T9s': 0.33, 'T8s': 0.55,
            '98s': 0.27, '87s': 0.35, '76s': 0.38, '65s': 0.39, '54s': 0.31,
            'AKo': 1.0, 'AQo': 0.30, 'AJo': 0.56, 'ATo': 0.47, 'KQo': 0.54, 'KJo': 0.28, 'QJo': 0.21,
        },
        'call': {
            'QQ': 0.14, 'JJ': 0.40, 'TT': 0.76, '99': 0.77, '88': 0.76,
            '77': 0.78, '66': 0.67, '55': 0.84, '44': 1.0, '33': 0.65, '22': 0.52,
            'AQs': 0.43, 'AJs': 1.0, 'ATs': 1.0, 'A9s': 0.66, 'A8s': 0.74,
            'A7s': 0.58, 'A6s': 0.29, 'A5s': 0.58, 'A4s': 0.38, 'A3s': 0.59, 'A2s': 0.20,
            'KQs': 0.89, 'KJs': 0.65, 'KTs': 0.83, 'K9s': 0.66, 'K8s': 0.49, 'K7s': 0.30, 'K6s': 0.06,
            'QJs': 0.48, 'QTs': 0.79, 'Q9s': 0.20,
            'JTs': 0.65, 'J9s': 0.50,
            'T9s': 0.67, 'T8s': 0.45,
            '98s': 0.73, '97s': 0.31, '87s': 0.61, '76s': 0.50, '65s': 0.61, '54s': 0.56,
            'AQo': 0.70, 'AJo': 0.44, 'ATo': 0.06, 'KQo': 0.46, 'KJo': 0.32, 'QJo': 0.15,
        },
    },
};

// Add BB_vs_MP alias (MP = HJ in 6-max) for V1 compatibility
THREE_BET_RANGES_V2['BB_vs_MP'] = THREE_BET_RANGES_V2['BB_vs_HJ'];

// =============================================================================
// VS 3-BET RANGES (When you open and face a 3bet)
// To be populated from additional screenshots
// =============================================================================

export const VS_THREE_BET_RANGES_V2: Record<string, Record<string, Record<string, number>>> = {

    // =========================================================================
    // UTG vs HJ 3-bet (UTG opens, HJ 3-bets)
    // 4-bet: 20.1%, Call: 21.1%, Fold: 58.8%
    // =========================================================================
    'UTG_vs_HJ_3bet': {
        '4bet': {
            'AA': 1.0, 'KK': 1.0, 'QQ': 0.60, 'JJ': 0.37, 'TT': 0.21, '99': 0.14, '88': 0.09, '77': 0.07, '66': 0.06,
            'AKs': 1.0, 'AQs': 0.21, 'AJs': 0.57, 'A5s': 0.60, 'A4s': 0.13,
            'KQs': 0.56, 'KJs': 0.36,
            'AKo': 0.62, 'AQo': 0.18,
        },
        'call': {
            'QQ': 0.40, 'JJ': 0.63, 'TT': 0.63, '99': 0.50, '88': 0.45, '77': 0.42, '66': 0.42, '55': 0.67,
            'AQs': 0.79, 'AJs': 0.43, 'ATs': 0.21, 'A5s': 0.36,
            'KQs': 0.44, 'KJs': 0.32,
            'QJs': 0.26, 'JTs': 0.40, 'T9s': 0.28,
            'AKo': 0.38,
        },
    },

    // =========================================================================
    // UTG vs CO 3-bet (UTG opens, CO 3-bets)
    // 4-bet: 22.1%, Call: 19.8%, Fold: 58.1%
    // =========================================================================
    'UTG_vs_CO_3bet': {
        '4bet': {
            'AA': 1.0, 'KK': 1.0, 'QQ': 0.73, 'JJ': 0.51, 'TT': 0.31, '99': 0.17, '88': 0.10, '77': 0.09,
            'AKs': 1.0, 'AJs': 0.57, 'A5s': 0.64,
            'KQs': 0.65, 'KJs': 0.54,
            'AKo': 0.72, 'AQo': 0.35, 'AQs': 0.21,
        },
        'call': {
            'QQ': 0.27, 'JJ': 0.49, 'TT': 0.66, '99': 0.49, '88': 0.42, '77': 0.38, '66': 0.39, '55': 0.71,
            'AQs': 0.79, 'AJs': 0.43, 'ATs': 0.23, 'A5s': 0.30,
            'KQs': 0.35, 'KJs': 0.41,
            'QJs': 0.30, 'JTs': 0.43, 'T9s': 0.20,
            'AKo': 0.28,
        },
    },

    // =========================================================================
    // UTG vs BTN 3-bet (UTG opens, BTN 3-bets)
    // 4-bet: 18%, Call: 30.5%, Fold: 51.5%
    // =========================================================================
    'UTG_vs_BTN_3bet': {
        '4bet': {
            'AA': 1.0, 'KK': 1.0, 'QQ': 0.19, 'JJ': 0.31, 'TT': 0.27, '99': 0.06, '88': 0.07,
            'AKs': 0.69, 'AJs': 0.46, 'ATs': 0.47, 'A7s': 0.15, 'A5s': 0.51, 'A4s': 0.29,
            'KQs': 0.19, 'KJs': 0.64, 'KTs': 0.39,
            'AKo': 0.58, 'AQo': 0.17,
        },
        'call': {
            'QQ': 0.81, 'JJ': 0.69, 'TT': 0.73, '99': 0.79, '88': 0.69, '77': 0.62, '66': 0.63, '55': 0.83,
            'AKs': 0.31, 'AQs': 1.0, 'AJs': 0.54, 'ATs': 0.53, 'A9s': 0.33, 'A5s': 0.43, 'A4s': 0.11,
            'KQs': 0.81, 'KJs': 0.36, 'KTs': 0.15,
            'QJs': 0.25, 'QTs': 0.11,
            'JTs': 0.69, 'T9s': 0.42,
            'AKo': 0.42,
        },
    },

    // =========================================================================
    // UTG vs SB 3-bet (UTG opens, SB 3-bets)
    // 4-bet: 10.5%, Call: 32.2%, Fold: 57.3%
    // =========================================================================
    'UTG_vs_SB_3bet': {
        '4bet': {
            'AA': 1.0, 'KK': 0.56, 'JJ': 0.13, '88': 0.06,
            'AKs': 0.42, 'A7s': 0.18, 'A5s': 0.24, 'A4s': 0.29, 'A3s': 0.14,
            'KJs': 0.60, 'K9s': 0.14,
            'AKo': 0.28, 'AQo': 0.10,
        },
        'call': {
            'KK': 0.44, 'QQ': 1.0, 'JJ': 0.87, 'TT': 1.0, '99': 0.42, '88': 0.44, '77': 0.29, '66': 0.27,
            'AKs': 0.58, 'AQs': 1.0, 'AJs': 1.0, 'ATs': 0.44, 'A5s': 0.71, 'A4s': 0.21,
            'KQs': 1.0, 'KJs': 0.40,
            'QJs': 0.75, 'QTs': 0.23,
            'JTs': 0.48, 'T9s': 0.39,
            'AKo': 0.72,
        },
    },

    // =========================================================================
    // UTG vs BB 3-bet (UTG opens, BB 3-bets)
    // 4-bet: 7.5%, Call: 35.6%, Fold: 56.9%
    // =========================================================================
    'UTG_vs_BB_3bet': {
        '4bet': {
            'AA': 0.78, 'KK': 0.35,
            'KTs': 0.33, 'KJs': 0.21,
            'A3s': 0.18, 'A5s': 0.14, 'A4s': 0.10, 'A9s': 0.09,
            'TT': 0.06,
            'AKo': 0.35,
        },
        'call': {
            'AA': 0.22, 'KK': 0.65, 'QQ': 1.0, 'JJ': 1.0, 'TT': 0.75,
            '99': 0.56, '88': 0.51, '77': 0.41, '66': 0.44, '55': 0.22,
            'AQs': 1.0, 'AJs': 1.0, 'ATs': 1.0, 'A9s': 0.20, 'A8s': 0.07,
            'A5s': 0.81, 'A4s': 0.27,
            'KQs': 1.0, 'KJs': 0.35, 'KTs': 0.14,
            'QJs': 0.55, 'QTs': 0.21,
            'JTs': 0.37, 'T9s': 0.54,
            'AKo': 0.65,
        },
    },

    // =========================================================================
    // HJ vs CO 3-bet (HJ opens, CO 3-bets)
    // 4-bet: 20.7%, Call: 20.7%, Fold: 58.6%
    // =========================================================================
    'HJ_vs_CO_3bet': {
        '4bet': {
            'AA': 1.0, 'KK': 1.0, 'QQ': 0.92, 'JJ': 0.62, 'TT': 0.35, '99': 0.17, '88': 0.17, '77': 0.10, '66': 0.06,
            'AKs': 1.0, 'AJs': 0.60, 'ATs': 0.39, 'A5s': 0.31,
            'KQs': 0.64, 'KJs': 0.49, 'KTs': 0.41,
            'QJs': 0.17,
            '65s': 0.24,
            'AKo': 0.79, 'AQo': 0.56,
        },
        'call': {
            'QQ': 0.09, 'JJ': 0.38, 'TT': 0.65, '99': 0.81, '88': 0.65, '77': 0.51, '66': 0.55, '55': 0.38,
            'AQs': 1.0, 'AJs': 0.40, 'ATs': 0.54, 'A5s': 0.32,
            'KQs': 0.36, 'KJs': 0.51, 'KTs': 0.35,
            'QJs': 0.46, 'JTs': 0.72, 'T9s': 0.27, '98s': 0.21,
            '65s': 0.75, '54s': 1.0, '53s': 1.0,
            'AKo': 0.21,
        },
    },

    // =========================================================================
    // HJ vs BTN 3-bet (HJ opens, BTN 3-bets)
    // 4-bet: 17.9%, Call: 29.1%, Fold: 53%
    // =========================================================================
    'HJ_vs_BTN_3bet': {
        '4bet': {
            'AA': 1.0, 'KK': 1.0, 'QQ': 0.45, 'JJ': 0.39, 'TT': 0.39, '99': 0.13, '88': 0.14, '77': 0.11,
            'AKs': 0.90, 'AJs': 0.09, 'ATs': 0.63, 'A5s': 0.48, 'A4s': 0.31,
            'KJs': 0.89, 'KTs': 0.54,
            'QJs': 0.07, 'JTs': 0.06,
            'AKo': 0.67, 'AQo': 0.48,
        },
        'call': {
            'QQ': 0.55, 'JJ': 0.61, 'TT': 0.61, '99': 0.87, '88': 0.86, '77': 0.83, '66': 0.74, '55': 0.56,
            'AKs': 0.10, 'AQs': 1.0, 'AJs': 0.92, 'ATs': 0.37, 'A9s': 0.51, 'A8s': 0.11, 'A5s': 0.51, 'A4s': 0.16,
            'KQs': 1.0, 'KJs': 0.11, 'KTs': 0.47,
            'QJs': 0.59, 'QTs': 0.45,
            'JTs': 0.76, 'T9s': 0.51, '98s': 0.20,
            'AKo': 0.33, 'AQo': 0.06,
        },
    },

    // =========================================================================
    // HJ vs SB 3-bet (HJ opens, SB 3-bets)
    // 4-bet: 10%, Call: 32.6%, Fold: 57.4%
    // =========================================================================
    'HJ_vs_SB_3bet': {
        '4bet': {
            'AA': 0.83, 'KK': 0.69, 'QQ': 0.18, 'JJ': 0.24, '88': 0.10,
            'AKs': 0.26, 'AJs': 0.13, 'A5s': 0.37, 'A4s': 0.19,
            'KJs': 0.35, 'KTs': 0.40, 'K9s': 0.10, 'K7s': 0.13,
            'AKo': 0.43, 'AQo': 0.24,
        },
        'call': {
            'AA': 0.17, 'KK': 0.31, 'QQ': 0.82, 'JJ': 0.76, 'TT': 1.0, '99': 0.90, '88': 0.62, '77': 0.45, '66': 0.43,
            'AKs': 0.74, 'AQs': 1.0, 'AJs': 0.87, 'ATs': 1.0, 'A5s': 0.61, 'A4s': 0.31,
            'KQs': 1.0, 'KJs': 0.65, 'KTs': 0.60,
            'QJs': 1.0, 'QTs': 0.14,
            'JTs': 1.0, 'T9s': 0.41,
            'AKo': 0.57, 'AQo': 0.27,
        },
    },

    // =========================================================================
    // HJ vs BB 3-bet (HJ opens, BB 3-bets)
    // 4-bet: 7.4%, Call: 35.8%, Fold: 56.9%
    // =========================================================================
    'HJ_vs_BB_3bet': {
        '4bet': {
            'AA': 0.72, 'KK': 0.59, 'JJ': 0.16,
            'A9s': 0.07, 'A7s': 0.16, 'A5s': 0.10, 'A4s': 0.07, 'A3s': 0.30,
            'KJs': 0.33, 'KTs': 0.24, 'K9s': 0.11,
            'AKo': 0.46, 'AQo': 0.14,
        },
        'call': {
            'AA': 0.28, 'KK': 0.41, 'QQ': 1.0, 'JJ': 0.84, 'TT': 1.0, '99': 0.87, '88': 0.78, '77': 0.51, '66': 0.51, '55': 0.16,
            'AKs': 1.0, 'AQs': 1.0, 'AJs': 1.0, 'ATs': 1.0, 'A9s': 0.41, 'A8s': 0.18, 'A5s': 0.87, 'A4s': 0.51,
            'KQs': 1.0, 'KJs': 0.67, 'KTs': 0.45,
            'QJs': 1.0, 'QTs': 0.67,
            'JTs': 0.63, 'T9s': 0.50, '98s': 0.17,
            'AKo': 0.54, 'AQo': 0.21,
        },
    },

    // =========================================================================
    // CO vs BTN 3-bet (CO opens, BTN 3-bets)
    // 4-bet: 17.5%, Call: 27.8%, Fold: 54.7%
    // =========================================================================
    'CO_vs_BTN_3bet': {
        '4bet': {
            'AA': 1.0, 'KK': 1.0, 'QQ': 1.0, 'JJ': 0.53, 'TT': 0.45, '99': 0.16, '88': 0.10, '77': 0.16,
            'AKs': 1.0, 'ATs': 0.42, 'A9s': 0.41, 'A8s': 0.20, 'A7s': 0.33, 'A5s': 0.67, 'A4s': 0.20,
            'KJs': 0.50, 'KTs': 0.70, 'K9s': 0.34,
            'QJs': 0.28, 'JTs': 0.28, 'T9s': 0.10,
            'AKo': 0.83, 'AQo': 0.75,
        },
        'call': {
            'JJ': 0.47, 'TT': 0.55, '99': 0.84, '88': 0.90, '77': 0.84, '66': 1.0, '55': 0.77, '44': 0.78, '33': 1.0,
            'AQs': 1.0, 'AJs': 1.0, 'ATs': 0.58, 'A9s': 0.59, 'A8s': 0.44, 'A5s': 0.31, 'A4s': 0.40,
            'KQs': 1.0, 'KJs': 0.50, 'KTs': 0.30, 'K9s': 0.34,
            'QJs': 0.72, 'QTs': 1.0,
            'JTs': 0.72, 'T9s': 0.79, 'T8s': 0.18, '98s': 0.38, '87s': 0.39, '76s': 0.74, '65s': 0.91, '32s': 0.50,
            'AKo': 0.17, 'AQo': 0.25,
        },
    },

    // =========================================================================
    // CO vs SB 3-bet (CO opens, SB 3-bets)
    // 4-bet: 10.5%, Call: 30.6%, Fold: 58.9%
    // =========================================================================
    'CO_vs_SB_3bet': {
        '4bet': {
            'AA': 0.69, 'KK': 0.81, 'QQ': 0.64, 'JJ': 0.44, 'TT': 0.11, '88': 0.12, '77': 0.10,
            'AKs': 0.47, 'A9s': 0.14, 'A5s': 0.25,
            'KTs': 0.24, 'K9s': 0.32,
            '76s': 0.07, '65s': 0.15,
            'AKo': 0.56, 'AQo': 0.33, 'AJo': 0.19,
        },
        'call': {
            'AA': 0.31, 'KK': 0.19, 'QQ': 0.36, 'JJ': 0.56, 'TT': 0.89, '99': 1.0, '88': 0.88, '77': 0.87, '66': 0.66, '55': 0.25, '44': 0.16, '33': 0.54,
            'AKs': 0.53, 'AQs': 1.0, 'AJs': 1.0, 'ATs': 1.0, 'A9s': 0.40, 'A5s': 0.73, 'A4s': 0.51,
            'KQs': 1.0, 'KJs': 1.0, 'KTs': 0.76, 'K9s': 0.21,
            'QJs': 1.0, 'QTs': 1.0,
            'JTs': 1.0, 'J9s': 0.37, 'T9s': 1.0, '98s': 0.11, '87s': 0.17, '76s': 0.60, '65s': 0.83, '54s': 1.0, '53s': 1.0,
            'AKo': 0.44, 'AQo': 0.67,
        },
    },

    // =========================================================================
    // CO vs BB 3-bet (CO opens, BB 3-bets)
    // 4-bet: 8.4%, Call: 33.4%, Fold: 58.2%
    // =========================================================================
    'CO_vs_BB_3bet': {
        '4bet': {
            'AA': 0.54, 'KK': 0.76, 'QQ': 0.47, 'JJ': 0.28,
            'A9s': 0.11, 'A8s': 0.17, 'A7s': 0.23, 'A4s': 0.13, 'A3s': 0.07,
            'K9s': 0.45, 'K7s': 0.09,
            'AKo': 0.72, 'AQo': 0.32,
        },
        'call': {
            'AA': 0.47, 'KK': 0.24, 'QQ': 0.53, 'JJ': 0.72, 'TT': 1.0, '99': 1.0, '88': 1.0, '77': 0.79, '66': 0.80, '55': 0.28, '44': 0.13, '33': 0.32,
            'AKs': 1.0, 'AQs': 1.0, 'AJs': 1.0, 'ATs': 1.0, 'A9s': 0.89, 'A8s': 0.51, 'A5s': 1.0, 'A4s': 0.87,
            'KQs': 1.0, 'KJs': 1.0, 'KTs': 1.0, 'K9s': 0.07,
            'QJs': 1.0, 'QTs': 1.0,
            'JTs': 1.0, 'T9s': 0.63, '98s': 0.25, '87s': 0.56, '76s': 0.51, '65s': 0.71, '54s': 0.61,
            'AKo': 0.28, 'AQo': 0.68, 'KQo': 0.14,
        },
    },

    // =========================================================================
    // BTN vs SB 3-bet (BTN opens, SB 3-bets)
    // 4-bet: 8.9%, Call: 40.7%, Fold: 50.4%
    // =========================================================================
    'BTN_vs_SB_3bet': {
        '4bet': {
            'AA': 0.86, 'KK': 1.0, 'QQ': 0.65, 'JJ': 0.46, 'TT': 0.29, '88': 0.10,
            'AKs': 0.92, 'A7s': 0.27, 'A6s': 0.17, 'A4s': 0.20, 'A2s': 0.17,
            'K9s': 0.17, 'K8s': 0.10, 'K6s': 0.07,
            'Q9s': 0.10, 'J8s': 0.13, '98s': 0.10, '97s': 0.13, '87s': 0.13, '65s': 0.09, '54s': 0.11,
            'AKo': 0.48, 'AJo': 0.28, 'ATo': 0.38, 'KQo': 0.09, 'KJo': 0.20, 'KTo': 0.06,
        },
        'call': {
            'AA': 0.14, 'QQ': 0.35, 'JJ': 0.54, 'TT': 0.71, '99': 1.0, '88': 0.90, '77': 1.0, '66': 1.0, '55': 1.0, '44': 1.0, '33': 1.0, '22': 1.0,
            'AKs': 0.08, 'AQs': 1.0, 'AJs': 1.0, 'ATs': 1.0, 'A9s': 1.0, 'A8s': 1.0, 'A7s': 0.73, 'A6s': 0.36,
            'A5s': 1.0, 'A4s': 0.80, 'A3s': 1.0, 'A2s': 0.51,
            'KQs': 1.0, 'KJs': 1.0, 'KTs': 1.0, 'K9s': 0.83, 'K8s': 0.90, 'K6s': 0.39,
            'QJs': 1.0, 'QTs': 1.0, 'Q9s': 0.90,
            'JTs': 1.0, 'J9s': 1.0, 'J8s': 0.87,
            'T9s': 1.0, 'T8s': 1.0, 'T7s': 0.70,
            '98s': 0.90, '97s': 0.87, '87s': 0.87, '86s': 0.49, '76s': 1.0, '65s': 0.92, '64s': 1.0, '54s': 0.89, '53s': 1.0, '43s': 1.0, '32s': 1.0,
            'AKo': 0.52, 'AQo': 1.0, 'AJo': 0.72, 'ATo': 0.10, 'KQo': 0.92, 'KJo': 0.37, 'KTo': 0.11, 'JTo': 0.17,
        },
    },

    // =========================================================================
    // BTN vs BB 3-bet (BTN opens, BB 3-bets)
    // 4-bet: 8.8%, Call: 35.3%, Fold: 56%
    // =========================================================================
    'BTN_vs_BB_3bet': {
        '4bet': {
            'AA': 0.54, 'KK': 1.0, 'QQ': 0.85, 'JJ': 0.46, 'TT': 0.26,
            'AKs': 0.17, 'A7s': 0.09, 'A6s': 0.37, 'A4s': 0.11, 'A2s': 0.17,
            'K9s': 0.17, 'K6s': 0.16,
            'Q9s': 0.10, 'J8s': 0.07, '98s': 0.23, '65s': 0.06,
            'AKo': 1.0, 'AQo': 0.17, 'AJo': 0.25, 'ATo': 0.17, 'KQo': 0.11, 'KJo': 0.13,
        },
        'call': {
            'AA': 0.47, 'QQ': 0.15, 'JJ': 0.54, 'TT': 0.74, '99': 1.0, '88': 1.0, '77': 1.0, '66': 1.0, '55': 1.0, '44': 1.0, '33': 0.41, '22': 0.16,
            'AKs': 0.83, 'AQs': 1.0, 'AJs': 1.0, 'ATs': 1.0, 'A9s': 1.0, 'A8s': 1.0, 'A7s': 0.91, 'A6s': 0.49,
            'A5s': 1.0, 'A4s': 0.89, 'A3s': 1.0, 'A2s': 0.27,
            'KQs': 1.0, 'KJs': 1.0, 'KTs': 1.0, 'K9s': 0.83, 'K8s': 0.27, 'K7s': 0.09, 'K6s': 0.36,
            'QJs': 1.0, 'QTs': 1.0, 'Q9s': 0.90,
            'JTs': 1.0, 'J9s': 1.0, 'J8s': 0.35,
            'T9s': 1.0, 'T8s': 1.0,
            '98s': 0.78, '87s': 1.0, '76s': 1.0, '65s': 0.83, '54s': 0.73,
            'AQo': 0.83, 'AJo': 0.75, 'KQo': 0.89, 'KJo': 0.51,
        },
    },

    // =========================================================================
    // SB vs BB 3-bet (SB opens, BB 3-bets)
    // 4-bet: 18%, Call: 33.7%, Fold: 48.3%
    // =========================================================================
    'SB_vs_BB_3bet': {
        '4bet': {
            'AA': 1.0, 'KK': 1.0, 'QQ': 1.0, 'JJ': 1.0, 'TT': 0.81, '99': 0.14, '77': 0.23, '55': 0.20,
            'AKs': 1.0, 'AQs': 1.0, 'A6s': 0.44, 'A5s': 0.39, 'A4s': 0.20, 'A3s': 0.24, 'A2s': 0.39,
            'K7s': 0.28, 'K6s': 0.33, 'K5s': 0.15,
            'QJs': 0.17, 'Q9s': 0.12, 'JTs': 0.15, 'J9s': 0.24, 'J8s': 0.11,
            'T9s': 0.21, 'T8s': 0.28, '98s': 0.29, '97s': 0.30,
            'AKo': 1.0, 'AQo': 0.57, 'AJo': 0.69, 'ATo': 0.58, 'KQo': 0.41, 'KJo': 0.49, 'KTo': 0.14, 'QJo': 0.13, 'JTo': 0.08,
        },
        'call': {
            'TT': 0.19, '99': 0.86, '88': 1.0, '77': 0.78, '66': 1.0, '55': 0.80, '44': 1.0, '33': 1.0, '22': 0.75,
            'AJs': 1.0, 'ATs': 1.0, 'A9s': 1.0, 'A8s': 1.0, 'A7s': 1.0, 'A6s': 0.56, 'A5s': 0.61, 'A4s': 0.80, 'A3s': 0.76, 'A2s': 0.61,
            'KQs': 1.0, 'KJs': 1.0, 'KTs': 1.0, 'K9s': 1.0, 'K8s': 1.0, 'K7s': 0.72, 'K6s': 0.27, 'K5s': 0.07,
            'QJs': 0.83, 'QTs': 1.0, 'Q9s': 0.88, 'Q8s': 0.80,
            'JTs': 0.85, 'J9s': 0.76, 'J8s': 0.89,
            'T9s': 0.79, 'T8s': 0.72, 'T7s': 0.44,
            '98s': 0.71, '97s': 0.69, '87s': 1.0, '76s': 1.0, '65s': 1.0, '54s': 1.0,
            'AQo': 0.43, 'AJo': 0.31, 'ATo': 0.42, 'KQo': 0.59, 'KJo': 0.51, 'KTo': 0.15, 'QJo': 0.35, 'JTo': 0.22,
        },
    },
};

// =============================================================================
// VS 4-BET RANGES (When you 3-bet and face a 4-bet)
// Actions: All-in (5-bet shove), Call, or Fold
// =============================================================================

export const VS_FOUR_BET_RANGES_V2: Record<string, Record<string, Record<string, number>>> = {

    // =========================================================================
    // BB vs SB 4-bet (BB 3-bet, SB 4-bets)
    // All-in: 10.9%, Call: 56.3%, Fold: 32.8%
    // =========================================================================
    'BB_vs_SB_4bet': {
        'allin': {
            'AKo': 1.0, 'JJ': 0.81, 'TT': 0.58, 'QQ': 0.44,
            'A5s': 0.51, 'A4s': 0.12,
            'KQs': 0.14, 'QJs': 0.26,
        },
        'call': {
            'AA': 1.0, 'KK': 1.0, 'QQ': 0.56, 'JJ': 0.19, 'TT': 0.42, '99': 1.0,
            'AKs': 1.0, 'AQs': 1.0, 'AJs': 1.0, 'A5s': 0.49, 'A4s': 0.88, 'A3s': 1.0,
            'KQs': 0.86, 'KJs': 1.0, 'KTs': 1.0,
            'QJs': 0.74, 'QTs': 1.0,
            'JTs': 1.0, 'J9s': 1.0,
            'T9s': 1.0, 'T8s': 1.0, '98s': 1.0, '97s': 1.0, '96s': 1.0,
            '87s': 1.0, '86s': 1.0, '76s': 1.0, '75s': 1.0, '65s': 1.0, '64s': 1.0, '54s': 1.0, '53s': 1.0,
            'AQo': 1.0,
        },
    },

    // =========================================================================
    // BB vs BTN 4-bet (BB 3-bet vs BTN open, BTN 4-bets)
    // All-in: 23.4%, Call: 43.9%, Fold: 32.7%
    // =========================================================================
    'BB_vs_BTN_4bet': {
        'allin': {
            'KK': 1.0, 'QQ': 1.0, 'JJ': 0.78, 'TT': 0.68, '99': 0.34,
            'AKs': 1.0, 'A5s': 0.80,
            'AKo': 1.0,
        },
        'call': {
            'AA': 1.0, 'JJ': 0.22, 'TT': 0.32, '99': 0.66,
            'AQs': 1.0, 'AJs': 1.0, 'A5s': 0.20,
            'KQs': 1.0, 'KJs': 1.0,
            'QJs': 1.0, 'QTs': 1.0,
            'JTs': 0.65, 'T9s': 1.0, 'T8s': 0.31, '98s': 1.0, '87s': 1.0, '65s': 1.0, '54s': 1.0, '53s': 1.0,
            'AQo': 0.88,
        },
    },

    // =========================================================================
    // BB vs CO 4-bet (BB 3-bet vs CO open, CO 4-bets)
    // All-in: 27.6%, Call: 30.1%, Fold: 42.3%
    // =========================================================================
    'BB_vs_CO_4bet': {
        'allin': {
            'AA': 0.30, 'KK': 1.0, 'QQ': 0.79, 'JJ': 0.73, 'TT': 0.44,
            'AKs': 1.0, 'AKo': 1.0,
        },
        'call': {
            'AA': 0.70, 'QQ': 0.21, 'JJ': 0.27, 'TT': 0.56,
            'AQs': 1.0, 'A5s': 0.71,
            'KQs': 0.51, 'KJs': 0.34,
            'QJs': 0.31, 'QTs': 0.39,
            'JTs': 0.68, '65s': 1.0, '64s': 1.0,
        },
    },

    // =========================================================================
    // BB vs HJ 4-bet (BB 3-bet vs HJ open, HJ 4-bets)
    // All-in: 32.3%, Call: 21.4%, Fold: 46.4%
    // =========================================================================
    'BB_vs_HJ_4bet': {
        'allin': {
            'AA': 1.0, 'KK': 1.0, 'QQ': 0.26, 'JJ': 0.73,
            'AKs': 1.0, 'AKo': 1.0,
        },
        'call': {
            'QQ': 0.74, 'JJ': 0.27,
            'AQs': 1.0,
            'JTs': 0.47, '54s': 0.26,
        },
    },

    // =========================================================================
    // BB vs UTG 4-bet (BB 3-bet vs UTG open, UTG 4-bets)
    // All-in: 31.2%, Call: 23.5%, Fold: 45.3%
    // =========================================================================
    'BB_vs_UTG_4bet': {
        'allin': {
            'AA': 1.0, 'KK': 1.0, 'QQ': 0.13,
            'AKs': 1.0, 'AKo': 0.90,
        },
        'call': {
            'QQ': 0.87,
            'A5s': 0.11,
            'AKo': 0.10,
        },
    },

    // =========================================================================
    // SB vs UTG 4-bet (SB 3-bet vs UTG open, UTG 4-bets)
    // All-in: 31%, Call: 28.1%, Fold: 41%
    // =========================================================================
    'SB_vs_UTG_4bet': {
        'allin': {
            'AA': 1.0, 'KK': 1.0, 'JJ': 0.31,
            'AKs': 1.0, 'AKo': 0.89,
        },
        'call': {
            'QQ': 1.0, 'JJ': 0.69, 'TT': 0.29,
            'AQs': 1.0, 'AJs': 0.31, 'ATs': 0.26, 'A5s': 0.14,
            'AKo': 0.11,
        },
    },

    // =========================================================================
    // SB vs HJ 4-bet (SB 3-bet vs HJ open, HJ 4-bets)
    // All-in: 30.3%, Call: 27.7%, Fold: 42%
    // =========================================================================
    'SB_vs_HJ_4bet': {
        'allin': {
            'AA': 0.66, 'KK': 1.0, 'QQ': 0.56, 'JJ': 0.59, 'TT': 0.11,
            'AKs': 1.0, 'AKo': 1.0,
        },
        'call': {
            'AA': 0.34, 'QQ': 0.44, 'JJ': 0.41, 'TT': 0.63, '99': 0.31,
            'AQs': 1.0, 'AJs': 0.69, 'ATs': 0.21, 'A5s': 0.40,
            'KJs': 0.13,
        },
    },

    // =========================================================================
    // SB vs CO 4-bet (SB 3-bet vs CO open, CO 4-bets)
    // All-in: 27.5%, Call: 34.1%, Fold: 38.4%
    // =========================================================================
    'SB_vs_CO_4bet': {
        'allin': {
            'AA': 0.30, 'KK': 1.0, 'QQ': 1.0, 'JJ': 0.63, 'TT': 0.41,
            'AKs': 1.0, 'A5s': 0.44,
            'AKo': 1.0,
        },
        'call': {
            'AA': 0.70, 'JJ': 0.37, 'TT': 0.59, '99': 0.54, '88': 0.76,
            'AQs': 1.0, 'AJs': 1.0, 'ATs': 0.45, 'A5s': 0.56, 'A4s': 0.23,
            'KQs': 1.0, 'KTs': 0.37,
            'QTs': 0.37, 'JTs': 0.49,
        },
    },

    // =========================================================================
    // SB vs BTN 4-bet (SB 3-bet vs BTN open, BTN 4-bets)
    // All-in: 21.4%, Call: 54.6%, Fold: 24%
    // =========================================================================
    'SB_vs_BTN_4bet': {
        'allin': {
            'KK': 1.0, 'QQ': 1.0, 'JJ': 0.69, 'TT': 0.39, '99': 0.21,
            'AKs': 1.0, 'A7s': 0.30, 'A5s': 0.71, 'A4s': 0.42,
            'AKo': 1.0,
        },
        'call': {
            'AA': 1.0, 'JJ': 0.31, 'TT': 0.61, '99': 0.79, '88': 1.0, '77': 1.0, '66': 1.0,
            'AQs': 1.0, 'AJs': 1.0, 'ATs': 1.0, 'A9s': 1.0, 'A8s': 0.61, 'A7s': 0.20, 'A5s': 0.29, 'A4s': 0.58,
            'KQs': 1.0, 'KJs': 1.0, 'KTs': 0.75,
            'QJs': 1.0, 'QTs': 1.0,
            'JTs': 0.56, 'T9s': 1.0,
            'AQo': 1.0,
        },
    },

    // =========================================================================
    // BTN vs UTG 4-bet (BTN 3-bet vs UTG open, UTG 4-bets)
    // All-in: 18.9%, Call: 38.7%, Fold: 42.4%
    // =========================================================================
    'BTN_vs_UTG_4bet': {
        'allin': {
            'AA': 0.29, 'KK': 1.0,
            'AKs': 1.0,
        },
        'call': {
            'AA': 0.71,
            'AQs': 1.0,
            'KQs': 1.0,
        },
    },

    // =========================================================================
    // BTN vs HJ 4-bet (BTN 3-bet vs HJ open, HJ 4-bets)
    // All-in: 17.3%, Call: 41%, Fold: 41.8%
    // =========================================================================
    'BTN_vs_HJ_4bet': {
        'allin': {
            'KK': 1.0, 'QQ': 0.26,
            'AKs': 0.62, 'KQs': 1.0,
            'AKo': 0.81,
        },
        'call': {
            'AA': 1.0, 'QQ': 0.74,
            'AKs': 0.38, 'AQs': 1.0,
            'AKo': 0.19,
        },
    },

    // =========================================================================
    // BTN vs CO 4-bet (BTN 3-bet vs CO open, CO 4-bets)
    // All-in: 20%, Call: 36.8%, Fold: 43.2%
    // =========================================================================
    'BTN_vs_CO_4bet': {
        'allin': {
            'KK': 1.0, 'QQ': 0.68,
            'AKs': 0.34,
            'AKo': 1.0,
        },
        'call': {
            'AA': 1.0, 'QQ': 0.32,
            'AKs': 0.66, 'AQs': 1.0, 'A4s': 0.35,
        },
    },

    // =========================================================================
    // CO vs HJ 4-bet (CO 3-bet vs HJ open, HJ 4-bets)
    // All-in: 16.3%, Call: 46.5%, Fold: 37.3%
    // =========================================================================
    'CO_vs_HJ_4bet': {
        'allin': {
            'KK': 1.0, 'QQ': 0.46,
            'AKs': 0.34,
            'AKo': 0.79,
        },
        'call': {
            'AA': 1.0, 'QQ': 0.54, 'JJ': 1.0, 'TT': 1.0, '99': 0.41,
            'AKs': 0.66, 'AQs': 1.0, 'AJs': 1.0, 'ATs': 0.25, 'A5s': 0.79,
            'KQs': 1.0, 'KJs': 0.35,
            'QJs': 0.28,
            'AKo': 0.21,
        },
    },

    // =========================================================================
    // CO vs UTG 4-bet (CO 3-bet vs UTG open, UTG 4-bets)
    // All-in: 18.9%, Call: 43%, Fold: 38%
    // =========================================================================
    'CO_vs_UTG_4bet': {
        'allin': {
            'AA': 0.53, 'KK': 1.0,
            'AKs': 0.55,
            'AKo': 0.74,
        },
        'call': {
            'AA': 0.47, 'QQ': 1.0, 'JJ': 1.0, 'TT': 0.56,
            'AKs': 0.45, 'AQs': 1.0, 'AJs': 1.0, 'A5s': 0.43,
            'KQs': 0.69,
            'QJs': 0.09, '65s': 1.0,
            'AKo': 0.26,
        },
    },

    // =========================================================================
    // HJ vs UTG 4-bet (HJ 3-bet vs UTG open, UTG 4-bets)
    // All-in: 20.1%, Call: 41%, Fold: 38.9%
    // =========================================================================
    'HJ_vs_UTG_4bet': {
        'allin': {
            'AA': 0.55, 'KK': 1.0,
            'AKs': 0.66,
            'AKo': 0.71,
        },
        'call': {
            'AA': 0.45, 'QQ': 1.0, 'JJ': 1.0, 'TT': 0.44,
            'AKs': 0.34, 'AQs': 1.0, 'AJs': 0.84, 'A5s': 0.29,
            'KQs': 0.36,
            'QJs': 0.14,
            'AKo': 0.29,
        },
    },
};

// Add V1-compatible key aliases for VS_FOUR_BET_RANGES (V1 uses "heroPos_3bet_vs_villainPos_4bet")
// BB 3-bet spots
VS_FOUR_BET_RANGES_V2['BB_3bet_vs_SB_4bet'] = VS_FOUR_BET_RANGES_V2['BB_vs_SB_4bet'];
VS_FOUR_BET_RANGES_V2['BB_3bet_vs_BTN_4bet'] = VS_FOUR_BET_RANGES_V2['BB_vs_BTN_4bet'];
VS_FOUR_BET_RANGES_V2['BB_3bet_vs_CO_4bet'] = VS_FOUR_BET_RANGES_V2['BB_vs_CO_4bet'];
VS_FOUR_BET_RANGES_V2['BB_3bet_vs_HJ_4bet'] = VS_FOUR_BET_RANGES_V2['BB_vs_HJ_4bet'];
VS_FOUR_BET_RANGES_V2['BB_3bet_vs_UTG_4bet'] = VS_FOUR_BET_RANGES_V2['BB_vs_UTG_4bet'];
// SB 3-bet spots
VS_FOUR_BET_RANGES_V2['SB_3bet_vs_UTG_4bet'] = VS_FOUR_BET_RANGES_V2['SB_vs_UTG_4bet'];
VS_FOUR_BET_RANGES_V2['SB_3bet_vs_HJ_4bet'] = VS_FOUR_BET_RANGES_V2['SB_vs_HJ_4bet'];
VS_FOUR_BET_RANGES_V2['SB_3bet_vs_CO_4bet'] = VS_FOUR_BET_RANGES_V2['SB_vs_CO_4bet'];
VS_FOUR_BET_RANGES_V2['SB_3bet_vs_BTN_4bet'] = VS_FOUR_BET_RANGES_V2['SB_vs_BTN_4bet'];
// BTN 3-bet spots
VS_FOUR_BET_RANGES_V2['BTN_3bet_vs_UTG_4bet'] = VS_FOUR_BET_RANGES_V2['BTN_vs_UTG_4bet'];
VS_FOUR_BET_RANGES_V2['BTN_3bet_vs_HJ_4bet'] = VS_FOUR_BET_RANGES_V2['BTN_vs_HJ_4bet'];
VS_FOUR_BET_RANGES_V2['BTN_3bet_vs_CO_4bet'] = VS_FOUR_BET_RANGES_V2['BTN_vs_CO_4bet'];
// CO 3-bet spots
VS_FOUR_BET_RANGES_V2['CO_3bet_vs_UTG_4bet'] = VS_FOUR_BET_RANGES_V2['CO_vs_UTG_4bet'];
VS_FOUR_BET_RANGES_V2['CO_3bet_vs_HJ_4bet'] = VS_FOUR_BET_RANGES_V2['CO_vs_HJ_4bet'];
// HJ 3-bet spots
VS_FOUR_BET_RANGES_V2['HJ_3bet_vs_UTG_4bet'] = VS_FOUR_BET_RANGES_V2['HJ_vs_UTG_4bet'];

// =============================================================================
// VS 5-BET RANGES (When you 4-bet and face a 5-bet all-in)
// Actions: Call or Fold (opponent already all-in)
// =============================================================================

export const VS_FIVE_BET_RANGES_V2: Record<string, Record<string, Record<string, number>>> = {

    // =========================================================================
    // UTG vs HJ 5-bet (UTG opens, HJ 3-bets, UTG 4-bets, HJ shoves)
    // Call: 64.9%, Fold: 35.1%
    // =========================================================================
    'UTG_vs_HJ_5bet': {
        'call': {
            'AA': 1.0, 'KK': 1.0, 'QQ': 1.0,
            'AKs': 1.0, 'AKo': 0.80,
        },
    },

    // =========================================================================
    // UTG vs CO 5-bet (UTG opens, CO 3-bets, UTG 4-bets, CO shoves)
    // Call: 66.6%, Fold: 33.4%
    // =========================================================================
    'UTG_vs_CO_5bet': {
        'call': {
            'AA': 1.0, 'KK': 1.0, 'QQ': 1.0,
            'AKs': 1.0, 'AKo': 1.0,
        },
    },

    // =========================================================================
    // UTG vs BTN 5-bet (UTG opens, BTN 3-bets, UTG 4-bets, BTN shoves)
    // Call: 61.8%, Fold: 38.2%
    // =========================================================================
    'UTG_vs_BTN_5bet': {
        'call': {
            'AA': 1.0, 'KK': 1.0,
            'AKs': 1.0,
        },
    },

    // =========================================================================
    // UTG vs SB 5-bet (UTG opens, SB 3-bets, UTG 4-bets, SB shoves)
    // Call: 64.8%, Fold: 35.2%
    // =========================================================================
    'UTG_vs_SB_5bet': {
        'call': {
            'AA': 1.0, 'KK': 1.0,
        },
    },

    // =========================================================================
    // UTG vs BB 5-bet (UTG opens, BB 3-bets, UTG 4-bets, BB shoves)
    // Call: 64.3%, Fold: 35.7%
    // =========================================================================
    'UTG_vs_BB_5bet': {
        'call': {
            'AA': 1.0,
        },
    },

    // =========================================================================
    // HJ vs CO 5-bet (HJ opens, CO 3-bets, HJ 4-bets, CO shoves)
    // Call: 64.7%, Fold: 35.3%
    // =========================================================================
    'HJ_vs_CO_5bet': {
        'call': {
            'AA': 1.0, 'KK': 1.0, 'QQ': 1.0, 'JJ': 1.0,
            'AKs': 1.0, 'AKo': 1.0,
        },
    },

    // =========================================================================
    // HJ vs BTN 5-bet (HJ opens, BTN 3-bets, HJ 4-bets, BTN shoves)
    // Call: 61.6%, Fold: 38.4%
    // =========================================================================
    'HJ_vs_BTN_5bet': {
        'call': {
            'AA': 1.0, 'KK': 1.0,
            'AKs': 1.0, 'AKo': 1.0,
        },
    },

    // =========================================================================
    // HJ vs SB 5-bet (HJ opens, SB 3-bets, HJ 4-bets, SB shoves)
    // Call: 61.7%, Fold: 38.3%
    // =========================================================================
    'HJ_vs_SB_5bet': {
        'call': {
            'AA': 1.0, 'KK': 1.0,
        },
    },

    // =========================================================================
    // HJ vs BB 5-bet (HJ opens, BB 3-bets, HJ 4-bets, BB shoves)
    // Call: 66.5%, Fold: 33.5%
    // =========================================================================
    'HJ_vs_BB_5bet': {
        'call': {
            'AA': 1.0, 'KK': 1.0,
            'AKo': 1.0,
        },
    },

    // =========================================================================
    // CO vs BTN 5-bet (CO opens, BTN 3-bets, CO 4-bets, BTN shoves)
    // Call: 57.4%, Fold: 42.6%
    // =========================================================================
    'CO_vs_BTN_5bet': {
        'call': {
            'AA': 1.0, 'KK': 1.0, 'QQ': 1.0,
            'AKs': 1.0, 'AKo': 1.0,
        },
    },

    // =========================================================================
    // CO vs SB 5-bet (CO opens, SB 3-bets, CO 4-bets, SB shoves)
    // Call: 62.3%, Fold: 37.7%
    // =========================================================================
    'CO_vs_SB_5bet': {
        'call': {
            'AA': 1.0, 'KK': 1.0, 'QQ': 1.0,
            'AKs': 1.0, 'AKo': 1.0,
            'KQs': 1.0, 'QJs': 1.0,
        },
    },

    // =========================================================================
    // CO vs BB 5-bet (CO opens, BB 3-bets, CO 4-bets, BB shoves)
    // Call: 65.6%, Fold: 34.4%
    // =========================================================================
    'CO_vs_BB_5bet': {
        'call': {
            'AA': 1.0, 'KK': 1.0, 'QQ': 1.0,
            'AKs': 1.0, 'AKo': 1.0, 'KQs': 1.0,
        },
    },

    // =========================================================================
    // BTN vs SB 5-bet (BTN opens, SB 3-bets, BTN 4-bets, SB shoves)
    // Call: 57.4%, Fold: 42.6%
    // =========================================================================
    'BTN_vs_SB_5bet': {
        'call': {
            'AA': 1.0, 'KK': 1.0, 'QQ': 1.0,
            'AKs': 1.0,
        },
    },

    // =========================================================================
    // BTN vs BB 5-bet (BTN opens, BB 3-bets, BTN 4-bets, BB shoves)
    // Call: 62.6%, Fold: 37.4%
    // =========================================================================
    'BTN_vs_BB_5bet': {
        'call': {
            'KK': 1.0, 'QQ': 1.0,
            'AKo': 1.0, 'KQs': 1.0, 'QJs': 1.0,
        },
    },

    // =========================================================================
    // SB vs BB 5-bet (SB opens, BB 3-bets, SB 4-bets, BB shoves)
    // Call: 51%, Fold: 49%
    // =========================================================================
    'SB_vs_BB_5bet': {
        'call': {
            'AA': 1.0, 'KK': 1.0, 'QQ': 1.0, 'JJ': 1.0, 'TT': 1.0,
            'AKs': 1.0, 'AQs': 1.0, 'AKo': 1.0, 'KQs': 1.0,
            'AQo': 0.19,
        },
    },
};

// =============================================================================
// AGGREGATE SPOT STATS
// Overall action frequencies for entire range (for pot odds / EV calculations)
// Source: GTO Wizard - shows what % of total range takes each action
// =============================================================================

export interface SpotStats {
    raise: number;      // % of range that raises/3-bets
    call: number;       // % of range that calls
    fold: number;       // % of range that folds
    raiseSize?: string; // e.g., "3x", "10.5bb"
    combos?: {          // Optional: exact combo counts
        raise: number;
        call: number;
        fold: number;
    };
}

export const SPOT_AGGREGATE_STATS: Record<string, SpotStats> = {
    // =========================================================================
    // RFI Stats (Raise vs Fold only from unopened pot)
    // =========================================================================
    'RFI_UTG': { raise: 0.164, call: 0, fold: 0.836, raiseSize: '3x' },
    'RFI_HJ': { raise: 0.203, call: 0, fold: 0.797, raiseSize: '3x' },
    'RFI_CO': { raise: 0.269, call: 0, fold: 0.731, raiseSize: '3x' },
    'RFI_BTN': { raise: 0.408, call: 0, fold: 0.592, raiseSize: '3x' },
    'RFI_SB': { raise: 0.431, call: 0, fold: 0.569, raiseSize: '3.5x' },

    // =========================================================================
    // BB Facing Raise Stats (3-bet vs Call vs Fold)
    // =========================================================================
    'BB_vs_SB': { raise: 0.163, call: 0.421, fold: 0.416, raiseSize: '10.5bb' },
    'BB_vs_BTN': { raise: 0.132, call: 0.276, fold: 0.592, raiseSize: '13.5bb' },
    'BB_vs_CO': { raise: 0.089, call: 0.208, fold: 0.703, raiseSize: '14bb' },
    'BB_vs_HJ': { raise: 0.069, call: 0.182, fold: 0.749, raiseSize: '14bb' },
    'BB_vs_UTG': { raise: 0.054, call: 0.168, fold: 0.778, raiseSize: '14bb' },

    // =========================================================================
    // SB Facing Raise Stats (3-bet or Fold - SB has no calling range)
    // =========================================================================
    'SB_vs_UTG': { raise: 0.068, call: 0, fold: 0.932, raiseSize: '13bb' },
    'SB_vs_HJ': { raise: 0.080, call: 0, fold: 0.920, raiseSize: '13bb' },
    'SB_vs_CO': { raise: 0.101, call: 0, fold: 0.899, raiseSize: '13bb' },
    'SB_vs_BTN': { raise: 0.143, call: 0, fold: 0.857, raiseSize: '12bb' },

    // =========================================================================
    // HJ/CO Facing Raise Stats (3-bet or Fold)
    // =========================================================================
    'HJ_vs_UTG': { raise: 0.072, call: 0, fold: 0.928, raiseSize: '9.5bb' },
    'CO_vs_UTG': { raise: 0.076, call: 0, fold: 0.924, raiseSize: '9.5bb' },
    'CO_vs_HJ': { raise: 0.088, call: 0, fold: 0.912, raiseSize: '9.5bb' },

    // =========================================================================
    // BTN Facing Raise Stats (3-bet, Call, or Fold)
    // =========================================================================
    'BTN_vs_UTG': { raise: 0.055, call: 0.100, fold: 0.846, raiseSize: '10bb' },
    'BTN_vs_HJ': { raise: 0.065, call: 0.104, fold: 0.830, raiseSize: '10bb' },
    'BTN_vs_CO': { raise: 0.084, call: 0.110, fold: 0.807, raiseSize: '10bb' },

    // =========================================================================
    // UTG Facing 3-Bet Stats (4-bet, Call, or Fold)
    // =========================================================================
    'UTG_vs_HJ_3bet': { raise: 0.201, call: 0.211, fold: 0.588, raiseSize: '24bb' },
    'UTG_vs_CO_3bet': { raise: 0.221, call: 0.198, fold: 0.581, raiseSize: '24bb' },
    'UTG_vs_BTN_3bet': { raise: 0.180, call: 0.305, fold: 0.515, raiseSize: '25bb' },
    'UTG_vs_SB_3bet': { raise: 0.105, call: 0.322, fold: 0.573, raiseSize: '27.5bb' },
    'UTG_vs_BB_3bet': { raise: 0.075, call: 0.356, fold: 0.569, raiseSize: '29.5bb' },

    // =========================================================================
    // HJ Facing 3-Bet Stats (4-bet, Call, or Fold)
    // =========================================================================
    'HJ_vs_CO_3bet': { raise: 0.207, call: 0.207, fold: 0.586, raiseSize: '24bb' },
    'HJ_vs_BTN_3bet': { raise: 0.179, call: 0.291, fold: 0.530, raiseSize: '25bb' },
    'HJ_vs_SB_3bet': { raise: 0.100, call: 0.326, fold: 0.574, raiseSize: '27.5bb' },
    'HJ_vs_BB_3bet': { raise: 0.074, call: 0.358, fold: 0.569, raiseSize: '29.5bb' },

    // =========================================================================
    // CO Facing 3-Bet Stats (4-bet, Call, or Fold)
    // =========================================================================
    'CO_vs_BTN_3bet': { raise: 0.175, call: 0.278, fold: 0.547, raiseSize: '25bb' },
    'CO_vs_SB_3bet': { raise: 0.105, call: 0.306, fold: 0.589, raiseSize: '27.5bb' },
    'CO_vs_BB_3bet': { raise: 0.084, call: 0.334, fold: 0.582, raiseSize: '29.5bb' },

    // =========================================================================
    // BTN Facing 3-Bet Stats (4-bet, Call, or Fold)
    // =========================================================================
    'BTN_vs_SB_3bet': { raise: 0.089, call: 0.407, fold: 0.504, raiseSize: '25bb' },
    'BTN_vs_BB_3bet': { raise: 0.088, call: 0.353, fold: 0.560, raiseSize: '28.5bb' },

    // =========================================================================
    // SB Facing 3-Bet Stats (4-bet, Call, or Fold)
    // =========================================================================
    'SB_vs_BB_3bet': { raise: 0.180, call: 0.337, fold: 0.483, raiseSize: '23bb' },

    // =========================================================================
    // BB Facing 4-Bet Stats (All-in, Call, or Fold)
    // =========================================================================
    'BB_vs_SB_4bet': { raise: 0.109, call: 0.563, fold: 0.328, raiseSize: '100bb' },
    'BB_vs_BTN_4bet': { raise: 0.234, call: 0.439, fold: 0.327, raiseSize: '100bb' },
    'BB_vs_CO_4bet': { raise: 0.276, call: 0.301, fold: 0.423, raiseSize: '100bb' },
    'BB_vs_HJ_4bet': { raise: 0.323, call: 0.214, fold: 0.464, raiseSize: '100bb' },
    'BB_vs_UTG_4bet': { raise: 0.312, call: 0.235, fold: 0.453, raiseSize: '100bb' },

    // =========================================================================
    // SB Facing 4-Bet Stats (All-in, Call, or Fold)
    // =========================================================================
    'SB_vs_UTG_4bet': { raise: 0.310, call: 0.281, fold: 0.410, raiseSize: '100bb' },
    'SB_vs_HJ_4bet': { raise: 0.303, call: 0.277, fold: 0.420, raiseSize: '100bb' },
    'SB_vs_CO_4bet': { raise: 0.275, call: 0.341, fold: 0.384, raiseSize: '100bb' },
    'SB_vs_BTN_4bet': { raise: 0.214, call: 0.546, fold: 0.240, raiseSize: '100bb' },

    // =========================================================================
    // BTN Facing 4-Bet Stats (All-in, Call, or Fold)
    // =========================================================================
    'BTN_vs_UTG_4bet': { raise: 0.189, call: 0.387, fold: 0.424, raiseSize: '100bb' },
    'BTN_vs_HJ_4bet': { raise: 0.173, call: 0.410, fold: 0.418, raiseSize: '100bb' },
    'BTN_vs_CO_4bet': { raise: 0.200, call: 0.368, fold: 0.432, raiseSize: '100bb' },

    // =========================================================================
    // CO Facing 4-Bet Stats (All-in, Call, or Fold)
    // =========================================================================
    'CO_vs_HJ_4bet': { raise: 0.163, call: 0.465, fold: 0.373, raiseSize: '100bb' },
    'CO_vs_UTG_4bet': { raise: 0.189, call: 0.430, fold: 0.380, raiseSize: '100bb' },

    // =========================================================================
    // HJ Facing 4-Bet Stats (All-in, Call, or Fold)
    // =========================================================================
    'HJ_vs_UTG_4bet': { raise: 0.201, call: 0.410, fold: 0.389, raiseSize: '100bb' },

    // =========================================================================
    // UTG Facing 5-Bet Stats (Call or Fold - opponent all-in)
    // =========================================================================
    'UTG_vs_HJ_5bet': { raise: 0, call: 0.649, fold: 0.351, raiseSize: 'N/A' },
    'UTG_vs_CO_5bet': { raise: 0, call: 0.666, fold: 0.334, raiseSize: 'N/A' },
    'UTG_vs_BTN_5bet': { raise: 0, call: 0.618, fold: 0.382, raiseSize: 'N/A' },
    'UTG_vs_SB_5bet': { raise: 0, call: 0.648, fold: 0.352, raiseSize: 'N/A' },
    'UTG_vs_BB_5bet': { raise: 0, call: 0.643, fold: 0.357, raiseSize: 'N/A' },

    // =========================================================================
    // HJ Facing 5-Bet Stats (Call or Fold - opponent all-in)
    // =========================================================================
    'HJ_vs_CO_5bet': { raise: 0, call: 0.647, fold: 0.353, raiseSize: 'N/A' },
    'HJ_vs_BTN_5bet': { raise: 0, call: 0.616, fold: 0.384, raiseSize: 'N/A' },
    'HJ_vs_SB_5bet': { raise: 0, call: 0.617, fold: 0.383, raiseSize: 'N/A' },
    'HJ_vs_BB_5bet': { raise: 0, call: 0.665, fold: 0.335, raiseSize: 'N/A' },

    // =========================================================================
    // CO Facing 5-Bet Stats (Call or Fold - opponent all-in)
    // =========================================================================
    'CO_vs_BTN_5bet': { raise: 0, call: 0.574, fold: 0.426, raiseSize: 'N/A' },
    'CO_vs_SB_5bet': { raise: 0, call: 0.623, fold: 0.377, raiseSize: 'N/A' },
    'CO_vs_BB_5bet': { raise: 0, call: 0.656, fold: 0.344, raiseSize: 'N/A' },

    // =========================================================================
    // BTN Facing 5-Bet Stats (Call or Fold - opponent all-in)
    // =========================================================================
    'BTN_vs_SB_5bet': { raise: 0, call: 0.574, fold: 0.426, raiseSize: 'N/A' },
    'BTN_vs_BB_5bet': { raise: 0, call: 0.626, fold: 0.374, raiseSize: 'N/A' },

    // =========================================================================
    // SB Facing 5-Bet Stats (Call or Fold - opponent all-in)
    // =========================================================================
    'SB_vs_BB_5bet': { raise: 0, call: 0.510, fold: 0.490, raiseSize: 'N/A' },
};

// =============================================================================
// Helper function to get spot stats
// =============================================================================

export function getSpotStats(spot: string): SpotStats | undefined {
    return SPOT_AGGREGATE_STATS[spot];
}

/**
 * Calculate if a bluff is profitable based on fold frequency
 * @param spot - The spot key (e.g., 'BB_vs_BTN')
 * @param betSize - Bet size in bb
 * @param potSize - Current pot size in bb
 * @returns { profitable: boolean, breakeven: number, actualFold: number }
 */
export function isBluffProfitable(
    spot: string,
    betSize: number,
    potSize: number
): { profitable: boolean; breakeven: number; actualFold: number } {
    const stats = SPOT_AGGREGATE_STATS[spot];
    if (!stats) {
        return { profitable: false, breakeven: 0, actualFold: 0 };
    }

    // Breakeven fold % = bet / (bet + pot)
    const breakeven = betSize / (betSize + potSize);
    const actualFold = stats.fold;

    return {
        profitable: actualFold >= breakeven,
        breakeven,
        actualFold,
    };
}

/**
 * Calculate ABSOLUTE frequency of a hand reaching a decision point.
 * 
 * Compounds all frequencies through the action chain.
 * 
 * @example
 * // QQ in BB 3-betting UTG, then facing 4-bet:
 * getAbsoluteFrequency('QQ', [
 *   { scenario: 'BB_vs_UTG', action: '3bet' },    // 50% 3-bet
 *   { scenario: 'BB_vs_UTG_4bet', action: 'call' } // 30% call the 4-bet
 * ]);
 * // Returns 0.15 (15% of QQ combos reach this point)
 */
export function getAbsoluteFrequency(
    hand: string,
    actionChain: { scenario: string; action: string }[]
): number {
    const normalized = normalizeHand(hand);
    let compoundFreq = 1.0;

    for (const step of actionChain) {
        let freq = 0;

        // Check which range type to use based on scenario pattern
        if (step.scenario.startsWith('RFI_')) {
            // RFI scenario
            const pos = step.scenario.replace('RFI_', '');
            freq = RFI_RANGES_V2[pos]?.[normalized] || 0;
        } else if (step.scenario.includes('_5bet')) {
            // VS 5-bet scenario
            freq = VS_FIVE_BET_RANGES_V2[step.scenario]?.[step.action]?.[normalized] || 0;
        } else if (step.scenario.includes('_4bet')) {
            // VS 4-bet scenario
            freq = VS_FOUR_BET_RANGES_V2[step.scenario]?.[step.action]?.[normalized] || 0;
        } else if (step.scenario.includes('_3bet')) {
            // VS 3-bet scenario
            freq = VS_THREE_BET_RANGES_V2[step.scenario]?.[step.action]?.[normalized] || 0;
        } else {
            // Facing open (3-bet/call scenario)
            freq = THREE_BET_RANGES_V2[step.scenario]?.[step.action]?.[normalized] || 0;
        }

        compoundFreq *= freq;

        // Early exit if frequency hit 0
        if (compoundFreq === 0) break;
    }

    return compoundFreq;
}

/**
 * Check if a hand made it through the previous action's range.
 * 
 * For multi-step scenarios (e.g., facing 4-bet), validates that
 * the hand was in the prior range before checking current action.
 * 
 * @example
 * isHandInRange('QQ', 'BB_vs_UTG_4bet');
 * // Returns true if QQ is in BB's 3-bet range vs UTG
 */
export function isHandInRange(hand: string, scenario: string): boolean {
    const normalized = normalizeHand(hand);

    // Determine the previous range based on scenario pattern
    if (scenario.includes('_5bet')) {
        // To face 5-bet, hand must have been in 4-bet range
        // Pattern: HERO_vs_VILLAIN_5bet → VILLAIN_vs_HERO_4bet (villain 4-bet us)
        // For now, just check if hand has any frequency in the 5-bet scenario
        const rangeData = VS_FIVE_BET_RANGES_V2[scenario];
        if (!rangeData) return false;
        const callFreq = rangeData['call']?.[normalized] || 0;
        return callFreq > 0;
    } else if (scenario.includes('_4bet')) {
        // To face 4-bet, hand must have been in 3-bet range
        // Extract positions: 'BB_vs_UTG_4bet' → check BB 3-bet vs UTG
        const match = scenario.match(/^(\w+)_vs_(\w+)_4bet$/);
        if (!match) return false;
        const [, hero, villain] = match;
        const threeBetKey = `${hero}_vs_${villain}`;
        const rangeData = THREE_BET_RANGES_V2[threeBetKey];
        if (!rangeData) return false;
        const threeBetFreq = rangeData['3bet']?.[normalized] || 0;
        return threeBetFreq > 0;
    } else if (scenario.includes('_3bet')) {
        // To face 3-bet, hand must have been in opening range
        // Extract opener: 'UTG_vs_BB_3bet' → check UTG RFI
        const match = scenario.match(/^(\w+)_vs_(\w+)_3bet$/);
        if (!match) return false;
        const [, opener] = match;
        const rfiFreq = RFI_RANGES_V2[opener]?.[normalized] || 0;
        return rfiFreq > 0;
    } else {
        // Simple facing open scenario - check if hand has any action
        const rangeData = THREE_BET_RANGES_V2[scenario];
        if (!rangeData) return false;
        const threeBetFreq = rangeData['3bet']?.[normalized] || 0;
        const callFreq = rangeData['call']?.[normalized] || 0;
        return threeBetFreq > 0 || callFreq > 0;
    }
}

/**
 * Get all aggregate stats for a spot (fold/call/raise percentages)
 * Useful for complete EV analysis in agents
 */
export function getAllSpotStats(spot: string): SpotStats | null {
    return SPOT_AGGREGATE_STATS[spot] || null;
}

// =============================================================================
// LOOKUP FUNCTIONS (Compatible with existing agent code)
// =============================================================================

/**
 * Get RFI action for a hand from a position
 * Returns frequency (0.0 to 1.0) or undefined if not in range
 */
export function getRFIAction(position: string, hand: string): number | undefined {
    const normPos = normalizePosition(position);
    const normHand = normalizeHand(hand);
    return RFI_RANGES_V2[normPos]?.[normHand];
}

/**
 * Check if a hand should RFI from a position
 * Returns true if in range with any frequency > 0
 */
export function shouldRFI(position: string, hand: string, threshold: number = 0.0): boolean {
    const freq = getRFIAction(position, hand);
    return freq !== undefined && freq > threshold;
}

/**
 * Get 3-bet or call action when facing an open (simplified version)
 * Returns { action: '3bet'|'call'|'fold', frequency: number }
 */
export function getFacingRaiseAction(
    heroPosition: string,
    villainPosition: string,
    hand: string
): { action: '3bet' | 'call' | 'fold'; frequency: number } {
    const key = `${normalizePosition(heroPosition)}_vs_${normalizePosition(villainPosition)}`;
    const normHand = normalizeHand(hand);

    const spot = THREE_BET_RANGES_V2[key];
    if (!spot) {
        return { action: 'fold', frequency: 1.0 };
    }

    const threeBetFreq = spot['3bet']?.[normHand] || 0;
    const callFreq = spot['call']?.[normHand] || 0;

    if (threeBetFreq > callFreq && threeBetFreq > 0) {
        return { action: '3bet', frequency: threeBetFreq };
    } else if (callFreq > 0) {
        return { action: 'call', frequency: callFreq };
    }
    return { action: 'fold', frequency: 1.0 };
}

// =============================================================================
// AGENT-COMPATIBLE LOOKUP FUNCTIONS (Match gtoRanges.ts interface)
// =============================================================================

/**
 * Get the opening action for a hand from a specific position
 * Returns RangeResult for compatibility with agent code
 */
export function getOpeningAction(hand: string, position: string): RangeResult {
    const normalized = normalizeHand(hand);
    const posKey = normalizePosition(position);

    const range = RFI_RANGES_V2[posKey];
    if (!range) {
        return {
            found: false,
            action: { action: 'fold', frequency: 1.0 },
            scenario: `RFI_${posKey}`,
            source: 'llm_fallback',
        };
    }

    const frequency = range[normalized];

    if (frequency !== undefined && frequency > 0) {
        const sizing = posKey === 'SB' ? '3.5bb' : '3bb'; // V2 uses 3bb standard
        return {
            found: true,
            action: { action: 'raise', frequency, sizing },
            scenario: `RFI_${posKey}`,
            source: 'range_table',
        };
    }

    // Not in range = fold
    return {
        found: true,
        action: { action: 'fold', frequency: 1.0 },
        scenario: `RFI_${posKey}`,
        source: 'range_table',
    };
}

/**
 * Get action when facing an open raise (call/3bet/fold)
 * Returns RangeResult for compatibility with agent code
 */
export function getFacingOpenAction(
    hand: string,
    heroPosition: string,
    openerPosition: string
): RangeResult {
    const normalized = normalizeHand(hand);
    const heroPos = normalizePosition(heroPosition);
    const openerPos = normalizePosition(openerPosition);
    const key = `${heroPos}_vs_${openerPos}`;

    const rangeData = THREE_BET_RANGES_V2[key];

    if (!rangeData) {
        return {
            found: false,
            action: { action: 'fold', frequency: 1.0 },
            scenario: key,
            source: 'llm_fallback',
        };
    }

    // Check 3bet range first
    const threeBetFreq = rangeData['3bet']?.[normalized] || 0;
    if (threeBetFreq >= 0.5) {
        const stats = SPOT_AGGREGATE_STATS[key];
        const sizing = stats?.raiseSize || '10bb';
        return {
            found: true,
            action: { action: '3bet', frequency: threeBetFreq, sizing },
            scenario: key,
            source: 'range_table',
        };
    }

    // Check call range
    const callFreq = rangeData['call']?.[normalized] || 0;
    if (callFreq >= 0.5) {
        return {
            found: true,
            action: { action: 'call', frequency: callFreq },
            scenario: key,
            source: 'range_table',
        };
    }

    // Mixed strategy or fold
    if (threeBetFreq > 0 || callFreq > 0) {
        if (threeBetFreq > callFreq) {
            const stats = SPOT_AGGREGATE_STATS[key];
            const sizing = stats?.raiseSize || '10bb';
            return {
                found: true,
                action: { action: '3bet', frequency: threeBetFreq, sizing },
                scenario: key,
                source: 'range_table',
            };
        } else {
            return {
                found: true,
                action: { action: 'call', frequency: callFreq },
                scenario: key,
                source: 'range_table',
            };
        }
    }

    // Fold
    return {
        found: true,
        action: { action: 'fold', frequency: 1.0 },
        scenario: key,
        source: 'range_table',
    };
}

/**
 * Get MIXED action when facing an open raise - returns BOTH primary AND alternative
 * Used for proper classification (so MistakeClassifier can mark alternatives as 'acceptable')
 */
export function getMixedFacingOpenAction(
    hand: string,
    heroPosition: string,
    openerPosition: string
): { primary: RangeAction; alternative?: RangeAction; scenario: string; found: boolean } {
    const normalized = normalizeHand(hand);
    const heroPos = normalizePosition(heroPosition);
    const openerPos = normalizePosition(openerPosition);
    const key = `${heroPos}_vs_${openerPos}`;

    const rangeData = THREE_BET_RANGES_V2[key];

    if (!rangeData) {
        return {
            found: false,
            primary: { action: 'fold', frequency: 1.0 },
            scenario: key
        };
    }

    const threeBetFreq = rangeData['3bet']?.[normalized] || 0;
    const callFreq = rangeData['call']?.[normalized] || 0;
    const stats = SPOT_AGGREGATE_STATS[key];
    const sizing = stats?.raiseSize || '10bb';

    // If both exist, return as primary/alternative
    if (threeBetFreq > 0 && callFreq > 0) {
        if (callFreq >= threeBetFreq) {
            // Call is primary, raise is alternative
            return {
                found: true,
                primary: { action: 'call', frequency: callFreq },
                alternative: { action: 'raise', frequency: threeBetFreq, sizing },
                scenario: key
            };
        } else {
            // Raise is primary, call is alternative
            return {
                found: true,
                primary: { action: 'raise', frequency: threeBetFreq, sizing },
                alternative: { action: 'call', frequency: callFreq },
                scenario: key
            };
        }
    }

    // Only one action exists
    if (threeBetFreq > 0) {
        return {
            found: true,
            primary: { action: 'raise', frequency: threeBetFreq, sizing },
            scenario: key
        };
    }
    if (callFreq > 0) {
        return {
            found: true,
            primary: { action: 'call', frequency: callFreq },
            scenario: key
        };
    }

    // Fold
    return {
        found: true,
        primary: { action: 'fold', frequency: 1.0 },
        scenario: key
    };
}

/**
 * Get MIXED action when facing a 3-bet - returns BOTH primary AND alternative
 * Used for proper classification (Hero opened, villain 3-bet)
 */
export function getMixedVs3BetAction(
    hand: string,
    heroPosition: string,
    threeBettorPosition: string
): { primary: RangeAction; alternative?: RangeAction; scenario: string; found: boolean } {
    const normalized = normalizeHand(hand);
    const heroPos = normalizePosition(heroPosition);
    const threeBettorPos = normalizePosition(threeBettorPosition);
    const key = `${heroPos}_vs_${threeBettorPos}_3bet`;

    const rangeData = VS_THREE_BET_RANGES_V2[key];

    if (!rangeData) {
        return {
            found: false,
            primary: { action: 'fold', frequency: 1.0 },
            scenario: key
        };
    }

    const fourBetFreq = rangeData['4bet']?.[normalized] || 0;
    const callFreq = rangeData['call']?.[normalized] || 0;
    const stats = SPOT_AGGREGATE_STATS[key];
    const sizing = stats?.raiseSize || '22bb';

    // If both exist, return as primary/alternative
    if (fourBetFreq > 0 && callFreq > 0) {
        if (callFreq >= fourBetFreq) {
            // Call is primary, 4bet is alternative
            return {
                found: true,
                primary: { action: 'call', frequency: callFreq },
                alternative: { action: 'raise', frequency: fourBetFreq, sizing },
                scenario: key
            };
        } else {
            // 4bet is primary, call is alternative
            return {
                found: true,
                primary: { action: 'raise', frequency: fourBetFreq, sizing },
                alternative: { action: 'call', frequency: callFreq },
                scenario: key
            };
        }
    }

    // Only one action exists
    if (fourBetFreq > 0) {
        return {
            found: true,
            primary: { action: 'raise', frequency: fourBetFreq, sizing },
            scenario: key
        };
    }
    if (callFreq > 0) {
        return {
            found: true,
            primary: { action: 'call', frequency: callFreq },
            scenario: key
        };
    }

    // Fold
    return {
        found: true,
        primary: { action: 'fold', frequency: 1.0 },
        scenario: key
    };
}

/**
 * Get MIXED action for opening (RFI) - returns primary AND potential alternative
 * Note: Opening ranges are typically pure (raise or fold), but this provides
 * the structure for consistency with other mixed action functions.
 */
export function getMixedOpeningAction(
    hand: string,
    position: string
): { primary: RangeAction; alternative?: RangeAction; scenario: string; found: boolean } {
    const normalized = normalizeHand(hand);
    const posKey = normalizePosition(position);
    const scenario = `RFI_${posKey}`;

    const range = RFI_RANGES_V2[posKey];
    if (!range) {
        return {
            found: false,
            primary: { action: 'fold', frequency: 1.0 },
            scenario
        };
    }

    const raiseFreq = range[normalized];
    const sizing = posKey === 'SB' ? '3.5bb' : '3bb';

    if (raiseFreq !== undefined && raiseFreq > 0) {
        // If it's a mixed strategy (less than 100%)
        if (raiseFreq < 1.0) {
            const foldFreq = 1.0 - raiseFreq;
            if (raiseFreq >= foldFreq) {
                return {
                    found: true,
                    primary: { action: 'raise', frequency: raiseFreq, sizing },
                    alternative: foldFreq >= 0.1 ? { action: 'fold', frequency: foldFreq } : undefined,
                    scenario
                };
            } else {
                return {
                    found: true,
                    primary: { action: 'fold', frequency: foldFreq },
                    alternative: raiseFreq >= 0.1 ? { action: 'raise', frequency: raiseFreq, sizing } : undefined,
                    scenario
                };
            }
        }
        // Pure raise (100%)
        return {
            found: true,
            primary: { action: 'raise', frequency: raiseFreq, sizing },
            scenario
        };
    }

    // Not in range = fold
    return {
        found: true,
        primary: { action: 'fold', frequency: 1.0 },
        scenario
    };
}

/**
 * Get action when CONSIDERING calling an open raise (Cold Call)
 * Uses the 'call' portion of THREE_BET_RANGES_V2
 */
export function getColdCallAction(
    hand: string,
    heroPosition: string,
    openerPosition: string
): RangeResult {
    const normalized = normalizeHand(hand);
    const key = `${normalizePosition(heroPosition)}_vs_${normalizePosition(openerPosition)}`;
    const rangeData = THREE_BET_RANGES_V2[key];

    if (!rangeData) {
        return {
            found: false,
            action: { action: 'fold', frequency: 1.0 },
            scenario: key,
            source: 'llm_fallback',
        };
    }

    const callFreq = rangeData['call']?.[normalized] || 0;

    if (callFreq > 0) {
        return {
            found: true,
            action: { action: 'call', frequency: callFreq },
            scenario: key,
            source: 'range_table',
        };
    }

    return {
        found: true,
        action: { action: 'fold', frequency: 1.0 },
        scenario: key,
        source: 'range_table',
    };
}

/**
 * Get action when CONSIDERING making a 3-bet (Hero vs Opener)
 * Returns the 3-bet frequency specifically for Range Building.
 */
export function getMaking3BetAction(
    hand: string,
    heroPosition: string,
    openerPosition: string
): RangeResult {
    const normalized = normalizeHand(hand);
    const key = `${normalizePosition(heroPosition)}_vs_${normalizePosition(openerPosition)}`;
    const rangeData = THREE_BET_RANGES_V2[key];

    if (!rangeData) {
        return {
            found: false,
            action: { action: 'fold', frequency: 1.0 },
            scenario: key,
            source: 'llm_fallback',
        };
    }

    const threeBetFreq = rangeData['3bet']?.[normalized] || 0;

    if (threeBetFreq > 0) {
        return {
            found: true,
            action: { action: '3bet', frequency: threeBetFreq },
            scenario: key,
            source: 'range_table',
        };
    }

    return {
        found: true,
        action: { action: 'fold', frequency: 1.0 },
        scenario: key,
        source: 'range_table',
    };
}

/**
 * Get action when facing a 3bet (after opening)
 * Uses VS_THREE_BET_RANGES_V2
 */
export function getVs3BetAction(
    hand: string,
    heroPosition: string,
    threeBettorPosition: string
): RangeResult {
    const normalized = normalizeHand(hand);
    const heroPos = normalizePosition(heroPosition);
    const threeBettorPos = normalizePosition(threeBettorPosition);
    const key = `${heroPos}_vs_${threeBettorPos}_3bet`;

    const rangeData = VS_THREE_BET_RANGES_V2[key];

    if (!rangeData) {
        return {
            found: false,
            action: { action: 'fold', frequency: 1.0 },
            scenario: key,
            source: 'llm_fallback',
        };
    }

    // Check 4bet range
    const fourBetFreq = rangeData['4bet']?.[normalized] || 0;
    if (fourBetFreq >= 0.5) {
        const stats = SPOT_AGGREGATE_STATS[key];
        const sizing = stats?.raiseSize || '22bb';
        return {
            found: true,
            action: { action: '4bet', frequency: fourBetFreq, sizing },
            scenario: key,
            source: 'range_table',
        };
    }

    // Check call range
    const callFreq = rangeData['call']?.[normalized] || 0;
    if (callFreq >= 0.5) {
        return {
            found: true,
            action: { action: 'call', frequency: callFreq },
            scenario: key,
            source: 'range_table',
        };
    }

    // Mixed or fold
    if (fourBetFreq > 0 || callFreq > 0) {
        if (fourBetFreq > callFreq) {
            const stats = SPOT_AGGREGATE_STATS[key];
            const sizing = stats?.raiseSize || '22bb';
            return {
                found: true,
                action: { action: '4bet', frequency: fourBetFreq, sizing },
                scenario: key,
                source: 'range_table',
            };
        } else {
            return {
                found: true,
                action: { action: 'call', frequency: callFreq },
                scenario: key,
                source: 'range_table',
            };
        }
    }

    // Fold
    return {
        found: true,
        action: { action: 'fold', frequency: 1.0 },
        scenario: key,
        source: 'range_table',
    };
}

/**
 * Get action when facing a 4bet (after you 3-bet)
 * Uses VS_FOUR_BET_RANGES_V2
 */
export function getVs4BetAction(
    hand: string,
    heroPosition: string,
    fourBettorPosition: string
): RangeResult {
    const normalized = normalizeHand(hand);
    const heroPos = normalizePosition(heroPosition);
    const fourBettorPos = normalizePosition(fourBettorPosition);
    // V1-compatible key pattern: heroPos_3bet_vs_fourBettorPos_4bet
    const v1Key = `${heroPos}_3bet_vs_${fourBettorPos}_4bet`;
    // V2 key pattern: heroPos_vs_fourBettorPos_4bet
    const v2Key = `${heroPos}_vs_${fourBettorPos}_4bet`;
    // Try V1 pattern first (for agent compatibility), then V2
    const rangeData = VS_FOUR_BET_RANGES_V2[v1Key] || VS_FOUR_BET_RANGES_V2[v2Key];
    const key = VS_FOUR_BET_RANGES_V2[v1Key] ? v1Key : v2Key;
    if (!rangeData) {
        return {
            found: false,
            action: { action: 'fold', frequency: 1.0 },
            scenario: key,
            source: 'llm_fallback',
        };
    }

    // Check all-in/5bet shove range
    const shoveFreq = rangeData['allin']?.[normalized] || 0;
    if (shoveFreq >= 0.5) {
        return {
            found: true,
            action: { action: '5bet', frequency: shoveFreq, sizing: 'all-in' },
            scenario: key,
            source: 'range_table',
        };
    }

    // Check call range
    const callFreq = rangeData['call']?.[normalized] || 0;
    if (callFreq >= 0.5) {
        return {
            found: true,
            action: { action: 'call', frequency: callFreq },
            scenario: key,
            source: 'range_table',
        };
    }

    // Mixed or fold
    if (shoveFreq > 0 || callFreq > 0) {
        if (shoveFreq > callFreq) {
            return {
                found: true,
                action: { action: '5bet', frequency: shoveFreq, sizing: 'all-in' },
                scenario: key,
                source: 'range_table',
            };
        } else {
            return {
                found: true,
                action: { action: 'call', frequency: callFreq },
                scenario: key,
                source: 'range_table',
            };
        }
    }

    // Fold
    return {
        found: true,
        action: { action: 'fold', frequency: 1.0 },
        scenario: key,
        source: 'range_table',
    };
}

/**
 * Get action when facing a 5bet all-in (after you 4-bet)
 * Uses VS_FIVE_BET_RANGES_V2 (V2 only - not in original gtoRanges.ts)
 */
export function getVs5BetAction(
    hand: string,
    heroPosition: string,
    fiveBettorPosition: string
): RangeResult {
    const normalized = normalizeHand(hand);
    const heroPos = normalizePosition(heroPosition);
    const fiveBettorPos = normalizePosition(fiveBettorPosition);
    const key = `${heroPos}_vs_${fiveBettorPos}_5bet`;

    const rangeData = VS_FIVE_BET_RANGES_V2[key];
    if (!rangeData) {
        return {
            found: false,
            action: { action: 'fold', frequency: 1.0 },
            scenario: key,
            source: 'llm_fallback',
        };
    }

    // Only call or fold at this point (opponent is all-in)
    const callFreq = rangeData['call']?.[normalized] || 0;
    if (callFreq > 0) {
        return {
            found: true,
            action: { action: 'call', frequency: callFreq },
            scenario: key,
            source: 'range_table',
        };
    }

    // Fold
    return {
        found: true,
        action: { action: 'fold', frequency: 1.0 },
        scenario: key,
        source: 'range_table',
    };
}

/**
 * Main function: Get preflop action based on game context
 * Compatible with original gtoRanges.ts interface
 */
export function getPreflopAction(
    hand: string,
    heroPosition: string,
    villainContext?: { type: string; villain: string | null }
): RangeResult {
    // Opening scenario (first to act)
    if (!villainContext || villainContext.type === 'opening') {
        return getOpeningAction(hand, heroPosition);
    }

    // Facing action (Open)
    if (villainContext.type === 'facing_action' && villainContext.villain) {
        return getFacingOpenAction(hand, heroPosition, villainContext.villain);
    }

    // Facing 3-Bet
    if (villainContext.type === 'vs_3bet' && villainContext.villain) {
        return getVs3BetAction(hand, heroPosition, villainContext.villain);
    }

    // Facing 4-Bet
    if (villainContext.type === 'vs_4bet' && villainContext.villain) {
        return getVs4BetAction(hand, heroPosition, villainContext.villain);
    }

    // Facing 5-Bet (V2 only)
    if (villainContext.type === 'vs_5bet' && villainContext.villain) {
        return getVs5BetAction(hand, heroPosition, villainContext.villain);
    }

    // SB vs BB
    if (villainContext.type === 'sb_vs_bb') {
        return getOpeningAction(hand, 'SB');
    }

    // Fallback
    return {
        found: false,
        action: { action: 'fold', frequency: 1.0 },
        scenario: 'unknown',
        source: 'llm_fallback',
    };
}

/**
 * Check if a hand is in any opening range for a position
 */
export function isInOpeningRange(hand: string, position: string): boolean {
    const result = getOpeningAction(hand, position);
    return result.found && result.action.action === 'raise';
}

/**
 * Get opening frequency for a hand at a position
 */
export function getOpeningFrequency(hand: string, position: string): number {
    const normalized = normalizeHand(hand);
    const posKey = normalizePosition(position);
    return RFI_RANGES_V2[posKey]?.[normalized] || 0;
}

// =============================================================================
// EXPORT DEFAULT
// =============================================================================

export default {
    // Range constants (aliased to match original names)
    RFI_RANGES: RFI_RANGES_V2,
    THREE_BET_RANGES: THREE_BET_RANGES_V2,
    VS_THREE_BET_RANGES: VS_THREE_BET_RANGES_V2,
    VS_FOUR_BET_RANGES: VS_FOUR_BET_RANGES_V2,
    VS_FIVE_BET_RANGES: VS_FIVE_BET_RANGES_V2,
    SPOT_AGGREGATE_STATS,

    // V2-specific helper functions
    getRFIAction,
    shouldRFI,
    getFacingRaiseAction,
    getSpotStats,
    isBluffProfitable,

    // Agent-compatible functions (match gtoRanges.ts interface)
    getOpeningAction,
    getFacingOpenAction,
    getMixedFacingOpenAction,
    getMixedVs3BetAction,
    getMixedOpeningAction,
    getColdCallAction,
    getMaking3BetAction,
    getVs3BetAction,
    getVs4BetAction,
    getVs5BetAction,
    getPreflopAction,
    isInOpeningRange,
    getOpeningFrequency,

    // Normalization utilities
    normalizeHand,
    normalizePosition,
};

// =============================================================================
// V1-COMPATIBLE NAMED EXPORTS (for UI pages that use named imports)
// =============================================================================
export const RFI_RANGES = RFI_RANGES_V2;
export const THREE_BET_RANGES = THREE_BET_RANGES_V2;
export const VS_THREE_BET_RANGES = VS_THREE_BET_RANGES_V2;
export const VS_FOUR_BET_RANGES = VS_FOUR_BET_RANGES_V2;
export const VS_FIVE_BET_RANGES = VS_FIVE_BET_RANGES_V2;
